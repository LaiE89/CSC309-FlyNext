(()=>{var e={};e.id=6743,e.ids=[6743],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6938:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>l});var a=t(65239),s=t(48088),o=t(88170),n=t.n(o),i=t(30893),d={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);t.d(r,d);let l={children:["",{children:["ui",{children:["dashboard",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,81906)),"/app/app/ui/dashboard/checkout/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13376)),"/app/app/ui/dashboard/layout.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,32648)),"/app/app/layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/app/app/ui/dashboard/checkout/page.js"],u={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/ui/dashboard/checkout/page",pathname:"/ui/dashboard/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},28728:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var a=t(60687),s=t(43210),o=t(16189),n=t(62844),i=t(21092);function d(){let e=(0,o.useSearchParams)().get("bookingId"),[r,t]=(0,s.useState)(""),[d,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(""),[x,m]=(0,s.useState)(null),[b,g]=(0,s.useState)(!1),f=(0,o.useRouter)(),{theme:y}=(0,i.D)(),v=async t=>{t.preventDefault(),u(null),h(""),m(null);let a=r.trim();if(!/^\d{16}$/.test(a)){u("Incorrect card number");return}g(!0),console.log("Checkout Page: Sending payload:",{bookingId:e,cardNumber:r,expiryDate:d});try{let r=await (0,n.v$)("/api/user/booking/checkout/combined",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:parseInt(e),cardNumber:a,expiryDate:d})}),t=await r.json();if(!r.ok)throw 440===r.status&&f.push("/ui/error/session-expired"),Error(t.error);console.log("Checkout Page: API response data:",t),h(t.message),m(t.invoice),localStorage.clear()}catch(e){u(e.message||"Checkout error")}finally{g(!1)}};return b?(0,a.jsx)("div",{className:`flex justify-center items-center h-64 ${"dark"===y?"text-white":"text-gray-800"}`,children:(0,a.jsx)("div",{className:"text-lg font-medium animate-pulse",children:"Loading..."})}):c?(0,a.jsx)("div",{className:`flex justify-center items-center h-64 ${"dark"===y?"text-white":"text-gray-800"}`,children:(0,a.jsxs)("div",{className:"px-6 py-4 rounded-md shadow-md bg-white",children:[(0,a.jsx)("p",{className:"font-semibold text-red-500",children:"Error:"}),(0,a.jsx)("p",{className:"text-red-500",children:c}),(0,a.jsx)("button",{onClick:()=>f.back(),className:"hover:underline cursor-pointer mt-2 text-red-500",children:"Go Back"})]})}):(0,a.jsxs)("div",{className:`max-w-lg mx-auto p-5 ${"dark"===y?"text-white":"text-gray-800"}`,children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Checkout"}),(0,a.jsxs)("p",{className:"mb-4",children:[(0,a.jsx)("strong",{children:"Booking ID:"})," ",e||"Not found"]}),p?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-green-500 mb-4",children:p}),x&&(0,a.jsx)("button",{onClick:()=>{if(!x)return;let e=atob(x),r=Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);let t=new Blob([new Uint8Array(r)],{type:"application/pdf"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="itinerary.pdf",s.click(),URL.revokeObjectURL(a)},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors mb-2",children:"Download Itinerary PDF"}),(0,a.jsx)("button",{onClick:()=>f.push("/ui/dashboard/bookings"),className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"View Bookings"})]}):(0,a.jsxs)("form",{onSubmit:v,className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:["Credit Card Number:",(0,a.jsx)("input",{type:"text",value:r,onChange:e=>t(e.target.value),placeholder:"16-digit card number",required:!0,className:`p-2 rounded-md border ${"dark"===y?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:["Expiry Date (MM/YY):",(0,a.jsx)("input",{type:"text",value:d,onChange:e=>l(e.target.value),placeholder:"MM/YY",required:!0,className:`p-2 rounded-md border ${"dark"===y?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`})]}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Processing...":"Pay and Confirm Booking"})]})]})}function l(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(d,{})})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80088:(e,r,t)=>{Promise.resolve().then(t.bind(t,81906))},81906:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});let a=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/app/app/ui/dashboard/checkout/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/app/app/ui/dashboard/checkout/page.js","default")},89816:(e,r,t)=>{Promise.resolve().then(t.bind(t,28728))}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[7719,1179,1658,2142,1026],()=>t(6938));module.exports=a})();