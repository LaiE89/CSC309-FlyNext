(()=>{var e={};e.id=8279,e.ids=[8279],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5644:(e,t,r)=>{Promise.resolve().then(r.bind(r,10268))},10268:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(60687),i=r(43210),a=r(16189),n=r(62844),o=r(21092);function l(){let e=(0,a.useRouter)(),{theme:t}=(0,o.D)(),[r,l]=(0,i.useState)([]),[d,c]=(0,i.useState)(null),[p,u]=(0,i.useState)(!0),[h,x]=(0,i.useState)(null),[m,g]=(0,i.useState)([]),b=(0,i.useCallback)(async()=>{u(!0);try{let t=await (0,n.v$)("/api/user/booking/user",{method:"GET",credentials:"include"}),r=await t.json();if(!t.ok)throw 440===t.status&&e.push("/ui/error/session-expired"),Error(r.error);r.sort((e,t)=>e.id<t.id?1:-1),l(r)}catch(e){c(e.message||"An unexpected error occurred.")}finally{u(!1)}},[e]),f=async t=>{u(!0);try{let r=await (0,n.v$)(`/api/user/booking/verify?bookingId=${encodeURIComponent(t)}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),s=await r.json();if(!r.ok)throw 440===r.status&&e.push("/ui/error/session-expired"),Error(s.error);x(s.message||"Verification complete"),g(e=>[...e,Number(t)])}catch(e){c(e.message||"An unexpected error occurred.")}finally{u(!1)}},j=async t=>{"PENDING"===t.bookStatus&&(localStorage.setItem("currentBookingId",t.id),e.push("/ui/dashboard/booking"))},w=async(t,r)=>{u(!0);try{let s=await (0,n.v$)("/api/user/booking/cancel/combined",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:t,cancelType:r})}),i=await s.json();if(!s.ok)throw 440===s.status&&e.push("/ui/error/session-expired"),Error(i.error||"Failed to cancel booking portion");await b(),("flight"===r||"both"===r)&&g(e=>e.filter(e=>Number(e)!==Number(t)))}catch(e){c(e.message||"An unexpected error occurred.")}finally{u(!1)}},k=e=>{w(e,"flight")},v=e=>{w(e,"room")},N=e=>{w(e,"both")},y=e=>e.flightBookingInfo?"Flight Scheduled":"No Flight Booked",C=e=>e.hotelId?"Hotel Booked":"No Hotel Booked",P=e=>{let t="";if(e.flightBookingInfo)try{let r=JSON.parse(e.flightBookingInfo);if(r.flights&&r.flights.length>0){let e=r.flights[0],s=r.flights[r.flights.length-1];t=`${new Date(e.departureTime).toLocaleDateString()} - ${new Date(s.arrivalTime).toLocaleDateString()}`}}catch(e){t="Invalid flight data"}let r="";return e.checkIn&&e.checkOut&&(r=`${new Date(e.checkIn).toLocaleDateString()} - ${new Date(e.checkOut).toLocaleDateString()}`),(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsxs)("div",{children:["Flight Dates: ",t]},`flight-${e.id}`),r&&(0,s.jsxs)("div",{children:["Hotel Dates: ",r]},`hotel-${e.id}`),!t&&!r&&(0,s.jsx)("div",{children:"N/A"},`none-${e.id}`)]})};return p?(0,s.jsx)("div",{className:`flex justify-center items-center h-64 ${"dark"===t?"text-white":"text-gray-800"}`,children:(0,s.jsx)("div",{className:"text-lg font-medium animate-pulse",children:"Loading Bookings..."})}):(0,s.jsxs)("div",{className:`max-w-4xl mx-auto p-4 ${"dark"===t?"text-white":"text-gray-800"}`,children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"My Bookings"}),d&&(0,s.jsxs)("p",{className:"text-red-500",children:["Error: ",d]}),h&&(0,s.jsx)("p",{className:"text-blue-500",children:h}),0===r.length?(0,s.jsx)("p",{children:"No bookings found."}):(0,s.jsx)("div",{className:"overflow-y-auto max-h-[700px]",children:(0,s.jsxs)("table",{className:"w-full border-collapse table-auto",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:`${"dark"===t?"bg-gray-800":"bg-gray-100"}`,children:[(0,s.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Booking ID"}),(0,s.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Status"}),(0,s.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Flight"}),(0,s.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Hotel"}),(0,s.jsx)("th",{className:"p-3 text-left min-w-[220px] whitespace-nowrap",children:"Dates"}),(0,s.jsx)("th",{className:"p-3 text-left min-w-[170px]",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:r.map(e=>{let{id:r,flightBookingInfo:i,hotelId:a,bookStatus:n}=e,o=y(e),l=C(e),d="CANCELLED"===n,c=m.includes(Number(r));return(0,s.jsxs)("tr",{className:`border-t ${"dark"===t?"border-gray-700":"border-gray-200"}`,children:[(0,s.jsxs)("td",{className:"p-2",children:[r,c&&(0,s.jsx)("span",{className:"text-blue-500 ml-1",children:"(Verified)"})]}),(0,s.jsx)("td",{className:"p-2",children:n}),(0,s.jsx)("td",{className:"p-2",children:o}),(0,s.jsx)("td",{className:"p-2",children:l}),(0,s.jsx)("td",{className:"p-2",children:P(e)}),(0,s.jsx)("td",{className:"p-2",children:d?(0,s.jsx)("span",{className:"text-gray-500",children:"No actions available"}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[i&&!c&&(0,s.jsx)("button",{onClick:()=>f(r),className:"w-48 min-w-[12rem] px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-all text-center",children:"Verify Flights"}),"PENDING"===n&&(0,s.jsx)("button",{onClick:()=>j(e),className:"w-48 min-w-[12rem] px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-all text-center",children:"Complete Booking"}),i&&(0,s.jsx)("button",{onClick:()=>k(r),className:"w-48 min-w-[12rem] px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-all text-center",children:"Cancel Flights"}),a&&(0,s.jsx)("button",{onClick:()=>v(r),className:"w-48 min-w-[12rem] px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-all text-center",children:"Cancel Hotels"}),(0,s.jsx)("button",{onClick:()=>N(r),className:"w-48 min-w-[12rem] px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-all text-center",children:"Cancel Entire Booking"})]})})})]},r)})})]})})]})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},18796:(e,t,r)=>{Promise.resolve().then(r.bind(r,20178))},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20178:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/app/app/ui/dashboard/bookings/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/app/app/ui/dashboard/bookings/page.js","default")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},51066:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>c,routeModule:()=>u,tree:()=>d});var s=r(65239),i=r(48088),a=r(88170),n=r.n(a),o=r(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d={children:["",{children:["ui",{children:["dashboard",{children:["bookings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,20178)),"/app/app/ui/dashboard/bookings/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,13376)),"/app/app/ui/dashboard/layout.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,32648)),"/app/app/layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/app/app/ui/dashboard/bookings/page.js"],p={require:r,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/ui/dashboard/bookings/page",pathname:"/ui/dashboard/bookings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,1179,1658,2142,1026],()=>r(51066));module.exports=s})();