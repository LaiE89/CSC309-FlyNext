(()=>{var e={};e.id=7870,e.ids=[7870],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11731:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(60687),i=t(43210),a=t(16189),o=t(21092),n=t(62844),l=t(26592);function d(){let e=(0,a.useRouter)(),{theme:r}=(0,o.D)(),{userRole:t}=(0,l.J)(),d=(0,a.useSearchParams)().get("location"),[u,c]=(0,i.useState)([]),[g,h]=(0,i.useState)(!1),[p,b]=(0,i.useState)(null),[m,x]=(0,i.useState)("Toronto"),[f,y]=(0,i.useState)(d||"Zurich"),[v,j]=(0,i.useState)(()=>new Date().toISOString().split("T")[0]),[w,k]=(0,i.useState)("one-way"),[N,S]=(0,i.useState)(""),[P,C]=(0,i.useState)([]),[E,T]=(0,i.useState)([]),[$,_]=(0,i.useState)(null),[R,A]=(0,i.useState)(null),[O,q]=(0,i.useState)(null),D=localStorage.getItem("currentBookingId"),F=D?parseInt(D,10):null,I=(0,i.useCallback)(async()=>{h(!0),b(null),_(null),A(null),q(null);try{let r={origin:m,destination:f,date:v,tripType:w};"round-trip"===w&&(r.returnDate=N);let t=new URLSearchParams(r).toString(),s=await fetch(`/api/visitor/flights?${t}`,{method:"GET",credentials:"include"}),i=await s.json();if(!s.ok)throw 440===s.status&&e.push("/ui/error/session-expired"),Error(i.error);c(i)}catch(e){b(e.message||"An unexpected error occurred.")}finally{h(!1)}},[m,f,v,w,N,e]),L=async e=>{try{let r=new URLSearchParams({query:e}).toString(),t=await fetch(`/api/visitor/flights/search?${r}`);if(!t.ok)throw Error("Failed to fetch origin suggestions");let s=await t.json();C(s.suggestions)}catch(e){console.error("Error fetching origin suggestions:",e)}},B=async e=>{try{let r=new URLSearchParams({query:e}).toString(),t=await fetch(`/api/visitor/flights/search?${r}`);if(!t.ok)throw Error("Failed to fetch destination suggestions");let s=await t.json();T(s.suggestions)}catch(e){console.error("Error fetching destination suggestions:",e)}},G=e=>{x(e),C([])},U=e=>{y(e),T([])},z=async r=>{try{let t,s;let i=JSON.stringify({flights:r.map(e=>({flightid:e.id,flightNumber:e.flightNumber,origin:e.origin.name,destination:e.destination.name,mainDestination:f,airline:e.airline.name,departureTime:e.departureTime,arrivalTime:e.arrivalTime,price:e.price,status:e.status}))});F?(t=await (0,n.v$)("/api/user/booking/edit",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:parseInt(F),flightBookingInfo:i})})).ok||440!==t.status||e.push("/ui/error/session-expired"):((t=await (0,n.v$)("/api/user/booking/create/combined",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({flightBookingInfo:i})})).ok||440!==t.status||e.push("/ui/error/session-expired"),s=await t.json(),localStorage.setItem("currentBookingId",s.id));return}catch(e){throw e}},H=async()=>{try{if(!$){b("Please select a route first.");return}await z($.flights),e.push("/ui/dashboard/booking")}catch(e){b(e.message||"Failed to create booking. Please try again.")}},J=async()=>{try{if(!R||!O){b("Please select both an outbound and an inbound route.");return}let r=[...R.flights,...O.flights];await z(r),e.push("/ui/dashboard/booking")}catch(e){b(e.message||"Failed to create booking. Please try again.")}},M=(e,r)=>{"outbound"===r?A(r=>r===e?null:e):"inbound"===r?q(r=>r===e?null:e):_(r=>r===e?null:e)},W=(e,i="one-way")=>!e||Array.isArray(e)&&0==e.length?(0,s.jsx)("div",{className:`${"dark"===r?"text-white":"text-gray-800"}`,children:"No flights found"}):(Array.isArray(e)?e:e.results||[]).map((e,a)=>{let o=!1;return o="outbound"===i?R===e:"inbound"===i?O===e:$===e,(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"15px",marginBottom:"15px",backgroundColor:o?"dark"===r?"dimgrey":"gainsboro":"transparent"},children:[(0,s.jsxs)("h3",{children:[e.legs," Leg(s)"]}),(0,s.jsx)("ul",{style:{listStyleType:"none",padding:0},children:e.flights.map((e,r)=>(0,s.jsxs)("li",{style:{marginBottom:"10px",paddingBottom:"10px",borderBottom:"1px solid #eee"},children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Flight Number:"})," ",e.flightNumber]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Airline:"})," ",e.airline.name," (",e.airline.code,")"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Departure:"})," ",e.origin.name," (",e.origin.code,") at"," ",new Date(e.departureTime).toLocaleString()]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Arrival:"})," ",e.destination.name," (",e.destination.code,") at"," ",new Date(e.arrivalTime).toLocaleString()]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Duration:"})," ",Math.floor(e.duration/60),"h ",e.duration%60,"m"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Price:"})," ",e.price," ",e.currency]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Available Seats:"})," ",e.availableSeats]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Status:"})," ",e.status]})]},r))}),("USER"===t||"HOTEL_OWNER"===t)&&(0,s.jsx)("button",{onClick:()=>M(e,i),style:{padding:"8px 12px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:o?"Unselect":"Select"})]},a)});return(0,s.jsxs)("div",{className:`max-w-4xl mx-auto p-4 ${"dark"===r?"text-white":"text-gray-800"}`,children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Flight Search"}),(0,s.jsxs)("div",{className:`p-6 rounded-2xl mb-6 transition-all duration-300 ${"dark"===r?"bg-gray-800":"bg-white shadow-lg"}`,children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Origin"}),(0,s.jsx)("input",{type:"text",value:m,onChange:e=>{let r=e.target.value;x(r),""!=r?L(r):C([])},placeholder:"Enter origin city or airport",className:`w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ${"dark"===r?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400"}`}),P.length>0&&(0,s.jsx)("ul",{className:`absolute top-full left-0 right-0 border overflow-y-auto z-10 list-none rounded shadow-md ${"dark"===r?"bg-gray-700 border-gray-600 divide-gray-600":"bg-white border-gray-300 divide-gray-200"}`,children:P.map((e,t)=>(0,s.jsx)("li",{onClick:()=>G(e),className:`p-3 cursor-pointer transition-colors ${"dark"===r?"hover:bg-gray-600":"hover:bg-gray-100"}`,children:e},t))})]}),(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Destination"}),(0,s.jsx)("input",{type:"text",value:f,onChange:e=>{let r=e.target.value;y(r),""!=r?B(r):T([])},placeholder:"Enter destination city or airport",className:`w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ${"dark"===r?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400"}`}),E.length>0&&(0,s.jsx)("ul",{className:`absolute top-full left-0 right-0 border overflow-y-auto z-10 list-none rounded shadow-md ${"dark"===r?"bg-gray-700 border-gray-600 divide-gray-600":"bg-white border-gray-300 divide-gray-200"}`,children:E.map((e,t)=>(0,s.jsx)("li",{onClick:()=>U(e),className:`p-3 cursor-pointer transition-colors ${"dark"===r?"hover:bg-gray-600":"hover:bg-gray-100"}`,children:e},t))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Trip Type"}),(0,s.jsxs)("select",{value:w,onChange:e=>k(e.target.value),className:`w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ${"dark"===r?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400"}`,children:[(0,s.jsx)("option",{value:"one-way",children:"One Way"}),(0,s.jsx)("option",{value:"round-trip",children:"Round Trip"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Departure Date"}),(0,s.jsx)("input",{type:"date",value:v,onChange:e=>j(e.target.value),className:`w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ${"dark"===r?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400"}`})]}),"round-trip"===w&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Return Date"}),(0,s.jsx)("input",{type:"date",value:N,onChange:e=>S(e.target.value),className:`w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ${"dark"===r?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400"}`})]})]}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("button",{onClick:I,disabled:g,className:`w-full md:w-auto px-6 py-3 font-semibold rounded-lg transition-colors ${g?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white`,children:g?"Searching...":"Search Flights"})})]}),u&&(0,s.jsxs)("div",{className:`p-6 rounded-lg ${"dark"===r?"bg-gray-800":"bg-white shadow-md"}`,children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Available Flights"}),"one-way"===w?(0,s.jsxs)("div",{children:[W(u),$&&("USER"===t||"HOTEL_OWNER"===t)&&(0,s.jsx)("button",{onClick:H,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Book Selected Flight"})]}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Outbound Flights"}),W(u.outbound?.results||[],"outbound")]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Inbound Flights"}),W(u.inbound?.results||[],"inbound")]}),R&&O&&("USER"===t||"HOTEL_OWNER"===t)&&(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("button",{onClick:J,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Book Selected Flights"})})]})]}),p&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:p})]})}function u(){return(0,s.jsx)(i.Suspense,{children:(0,s.jsx)(d,{})})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21e3:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>g,tree:()=>d});var s=t(65239),i=t(48088),a=t(88170),o=t.n(a),n=t(30893),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(r,l);let d={children:["",{children:["ui",{children:["dashboard",{children:["flights",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,59277)),"/app/app/ui/dashboard/flights/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13376)),"/app/app/ui/dashboard/layout.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,32648)),"/app/app/layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,u=["/app/app/ui/dashboard/flights/page.js"],c={require:t,loadChunk:()=>Promise.resolve()},g=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/ui/dashboard/flights/page",pathname:"/ui/dashboard/flights",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},24693:(e,r,t)=>{Promise.resolve().then(t.bind(t,11731))},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},55511:e=>{"use strict";e.exports=require("crypto")},59277:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/app/app/ui/dashboard/flights/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/app/app/ui/dashboard/flights/page.js","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},82837:(e,r,t)=>{Promise.resolve().then(t.bind(t,59277))}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,1179,1658,2142,1026],()=>t(21e3));module.exports=s})();