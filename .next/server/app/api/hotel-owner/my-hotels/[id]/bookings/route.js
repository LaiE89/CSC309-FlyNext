(()=>{var e={};e.id=1380,e.ids=[1380],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},62802:(e,t,r)=>{"use strict";r.d(t,{Er:()=>c,HU:()=>f,HY:()=>h,b9:()=>d,nr:()=>x});var s=r(43205),n=r.n(s),o=r(85663);let i=process.env.ACCESS_SECRET,a=process.env.REFRESH_SECRET,u=process.env.ACCESS_TOKEN_EXPIRY,l=process.env.REFRESH_TOKEN_EXPIRY,p=parseInt(process.env.SALT_ROUNDS,10);function c(e){return o.Ay.hashSync(e,p)}function d(e,t){return o.Ay.compareSync(e,t)}function f(e,t){return t?n().sign(e,i,{expiresIn:u}):n().sign(e,a,{expiresIn:l})}function h(e){return e?g(u):g(l)}function x(e,t){let r;if("object"==typeof e){let t=e.headers.get("Authorization");if(!t)return null;r=t.replace("Bearer ","")}else r=e;try{let e;if((e=t?n().verify(r,i):n().verify(r,a)).exp&&e.exp<Math.floor(Date.now()/1e3))return null;return e}catch{return null}}function g(e){let t;let r=e.slice(-1),s=parseInt(e.slice(0,-1),10);if("s"===r)t=s;else if("m"===r)t=60*s;else if("h"===r)t=3600*s;else if("d"===r)t=86400*s;else throw Error("Unsupported time unit");return t}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},81643:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>c,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>p});var n=r(96559),o=r(48088),i=r(37719),a=r(32190),u=r(62802),l=r(97474);async function p(e,{params:t}){let r=e.cookies.get("token")?.value;if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let s=(0,u.nr)(r,!0);if(!s)return a.NextResponse.json({error:"Invalid token"},{status:403});if("HOTEL_OWNER"!==s.role)return a.NextResponse.json({error:"Access Denied"},{status:403});try{let{id:r}=await t;if(!r)return a.NextResponse.json({error:"Hotel ID is required"},{status:400});let{searchParams:n}=new URL(e.url),o=n.get("startDate")?new Date(n.get("startDate")):null,i=n.get("endDate")?new Date(n.get("endDate")):null,u=n.get("roomType");if(o&&isNaN(o))return a.NextResponse.json({error:"Invalid startDate format"},{status:400});if(i&&isNaN(i))return a.NextResponse.json({error:"Invalid endDate format"},{status:400});let p={hotelId:parseInt(r,10)};if(o&&i?(p.checkIn={gte:o},p.checkOut={lte:i}):o?p.checkIn={gte:o}:i&&(p.checkOut={lte:i}),(await l.z.hotel.findUnique({where:{id:parseInt(r,10)}})).ownerId!=s.id)return a.NextResponse.json({error:"Access Denied"},{status:403});let c=await l.z.booking.findMany({where:p,include:{room:!0}});if(!c)return a.NextResponse.json({error:"Bookings not found"},{status:404});let d=u?c.filter(e=>e.room?.type===u):c,f=o&&i?{none:{AND:[{checkIn:{lt:i}},{checkOut:{gt:o}}]}}:{},h=(await l.z.room.groupBy({by:["type"],where:{hotelId:parseInt(r,10),available:!0,...u?{type:u}:{},bookings:f},_count:{id:!0}})).map(e=>({type:e.type,available:e._count.id}));return console.log(h),a.NextResponse.json({bookings:d,roomAvailability:h},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error fetching bookings and availability:",e),a.NextResponse.json({error:"Internal Server Error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/hotel-owner/my-hotels/[id]/bookings/route",pathname:"/api/hotel-owner/my-hotels/[id]/bookings",filename:"route",bundlePath:"app/api/hotel-owner/my-hotels/[id]/bookings/route"},resolvedPagePath:"/app/app/api/hotel-owner/my-hotels/[id]/bookings/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:h}=c;function x(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97474:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});let s=new(r(96330)).PrismaClient}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,5315],()=>r(81643));module.exports=s})();