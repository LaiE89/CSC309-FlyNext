(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},61232:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>c,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>l});var n=r(96559),o=r(48088),i=r(37719),a=r(32190),p=r(97474),u=r(62802);async function l(e){try{let{email:t,password:r,isVisitor:s}=await e.json();if("boolean"==typeof s?s:"true"===s){let e=a.NextResponse.json({status:200,headers:{"Content-Type":"application/json"}});return e.headers.set("Set-Cookie","token=; HttpOnly; Path=/; Max-Age=0; Secure"),e.headers.append("Set-Cookie","refresh_token=; HttpOnly; Path=/; Max-Age=0; Secure"),e}let n=await p.z.user.findUnique({where:{email:t}});if(!n)return a.NextResponse.json({error:"User with this email does not exist"},{status:401,headers:{"Content-Type":"application/json"}});if(!(0,u.b9)(r,n.password))return a.NextResponse.json({error:"Password is invalid"},{status:401,headers:{"Content-Type":"application/json"}});let o={id:n.id,email:n.email,role:n.role,expiresAt:Math.floor(Date.now()/1e3)+(0,u.HY)(!0)},i=(0,u.HU)(o,!0),l=(0,u.HU)(o,!1),c=a.NextResponse.json({status:200,headers:{"Content-Type":"application/json"}});return c.headers.set("Set-Cookie",`token=${i}; HttpOnly; Path=/; Max-Age=${(0,u.HY)(!0)}; Secure`),c.headers.append("Set-Cookie",`refresh_token=${l}; HttpOnly; Path=/; Max-Age=${(0,u.HY)(!1)}; Secure`),c}catch(e){return a.NextResponse.json({error:"Internal Server Error"},{status:500,headers:{"Content-Type":"application/json"}})}}let c=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/app/app/api/auth/login/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:h,serverHooks:x}=c;function f(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:h})}},62802:(e,t,r)=>{"use strict";r.d(t,{Er:()=>c,HU:()=>h,HY:()=>x,b9:()=>d,nr:()=>f});var s=r(43205),n=r.n(s),o=r(85663);let i=process.env.ACCESS_SECRET,a=process.env.REFRESH_SECRET,p=process.env.ACCESS_TOKEN_EXPIRY,u=process.env.REFRESH_TOKEN_EXPIRY,l=parseInt(process.env.SALT_ROUNDS,10);function c(e){return o.Ay.hashSync(e,l)}function d(e,t){return o.Ay.compareSync(e,t)}function h(e,t){return t?n().sign(e,i,{expiresIn:p}):n().sign(e,a,{expiresIn:u})}function x(e){return e?y(p):y(u)}function f(e,t){let r;if("object"==typeof e){let t=e.headers.get("Authorization");if(!t)return null;r=t.replace("Bearer ","")}else r=e;try{let e;if((e=t?n().verify(r,i):n().verify(r,a)).exp&&e.exp<Math.floor(Date.now()/1e3))return null;return e}catch{return null}}function y(e){let t;let r=e.slice(-1),s=parseInt(e.slice(0,-1),10);if("s"===r)t=s;else if("m"===r)t=60*s;else if("h"===r)t=3600*s;else if("d"===r)t=86400*s;else throw Error("Unsupported time unit");return t}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97474:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});let s=new(r(96330)).PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,5315],()=>r(61232));module.exports=s})();