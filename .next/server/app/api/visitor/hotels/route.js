(()=>{var e={};e.id=8978,e.ids=[8978],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76238:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>d});var i={};r.r(i),r.d(i,{GET:()=>u});var n=r(96559),s=r(48088),a=r(37719),o=r(32190),c=r(97474);async function u(e){try{let t;let{searchParams:r}=new URL(e.url),i=r.get("checkIn"),n=r.get("checkOut"),s=r.get("city"),a=r.get("name"),u=r.get("starRating"),l=r.get("minPrice"),p=r.get("maxPrice"),d=r.get("priceAscending"),g=i?new Date(i):null,h=n?new Date(n):null,m={};s&&(m.city={contains:s}),a&&(m.name={contains:a}),u&&(m.starRating=parseInt(u,10)),m.rooms={some:{available:!0,...l||p?{pricePerNight:{...l?{gte:Number(l)}:{},...p?{lte:Number(p)}:{}}}:{},...g&&h?{bookings:{none:{AND:[{checkIn:{lt:h}},{checkOut:{gt:g}}]}}}:{}}};let x=await c.z.hotel.findMany({where:m,include:{rooms:{where:{available:!0,...l||p?{pricePerNight:{...l?{gte:Number(l)}:{},...p?{lte:Number(p)}:{}}}:{},...g&&h?{bookings:{none:{AND:[{checkIn:{lt:h}},{checkOut:{gt:g}}]}}}:{}},orderBy:{pricePerNight:"asc"}}}}),P=await c.z.hotel.findMany({where:m,include:{rooms:{where:{available:!0},orderBy:{pricePerNight:"asc"}}}}),v=x.map(e=>{let t=P.find(t=>t.id===e.id),r=t&&t.rooms.length>0?t.rooms[0].pricePerNight:null;return{...e,startingPrice:r,mapLocation:e.city.concat(", ",e.country),filteredRooms:e.rooms.map(e=>e.id)}});return t=("boolean"==typeof d?d:"true"===d)?v.sort((e,t)=>{let r=null!==e.startingPrice?e.startingPrice:1/0,i=null!==t.startingPrice?t.startingPrice:1/0;return r-i}):v.sort((e,t)=>{let r=null!==e.startingPrice?e.startingPrice:1/0;return(null!==t.startingPrice?t.startingPrice:1/0)-r}),o.NextResponse.json({hotels:t},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return o.NextResponse.json({error:"Internal Server Error"},{status:500,headers:{"Content-Type":"application/json"}})}}let l=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/visitor/hotels/route",pathname:"/api/visitor/hotels",filename:"route",bundlePath:"app/api/visitor/hotels/route"},resolvedPagePath:"/app/app/api/visitor/hotels/route.js",nextConfigOutput:"",userland:i}),{workAsyncStorage:p,workUnitAsyncStorage:d,serverHooks:g}=l;function h(){return(0,a.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:d})}},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97474:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});let i=new(r(96330)).PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[7719,580],()=>r(76238));module.exports=i})();