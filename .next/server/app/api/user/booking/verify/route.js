(()=>{var e={};e.id=1689,e.ids=[1689],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33990:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>f,serverHooks:()=>g,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>d});var s={};t.r(s),t.d(s,{GET:()=>l});var n=t(96559),i=t(48088),o=t(37719),u=t(97474),a=t(32190),p=t(62802);async function l(e){let r=e.cookies.get("token")?.value;if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=(0,p.nr)(r,!0);if(!t)return a.NextResponse.json({error:"Invalid token"},{status:403});if("USER"!==t.role&&"HOTEL_OWNER"!==t.role)return a.NextResponse.json({error:"Access Denied"},{status:403});try{let r,s;let{searchParams:n}=new URL(e.url),i=n.get("bookingId");if(!i)return a.NextResponse.json({error:"Missing bookingId"},{status:400});let o=await u.z.booking.findUnique({where:{id:parseInt(i)}});if(!o||o.userId!==t.id)return a.NextResponse.json({error:"Booking not found"},{status:404});if(!o.flightBookingInfo)return a.NextResponse.json({verified:!1,message:"No flight booking info available"},{status:200});try{r=JSON.parse(o.flightBookingInfo)}catch(e){return a.NextResponse.json({verified:!1,message:"Invalid flight booking info"},{status:400})}if(!r.flights||!Array.isArray(r.flights)||0===r.flights.length)return a.NextResponse.json({verified:!1,message:"No flights found in booking info"},{status:400});let p=process.env.AFS_URL,l=process.env.AFS_API_KEY;if(!l)return a.NextResponse.json({error:"AFS API Key not configured"},{status:500});let f=r.flights.map(async e=>{if(!e.flightid)throw Error("Flight id missing in one of the flights");let r=`${p}/api/flights/${encodeURIComponent(e.flightid)}`,t=await fetch(r,{headers:{"x-api-key":l}});if(!t.ok){let r=await t.text();throw Error(`AFS API error for flight ${e.flightid}: ${r}`)}return await t.json()});try{s=await Promise.all(f)}catch(e){return a.NextResponse.json({error:"Error verifying flights"},{status:500})}if(!s.every(e=>"SCHEDULED"===e.status)){let e=s.find(e=>"SCHEDULED"!==e.status);return a.NextResponse.json({verified:!1,message:`Flight ${e.flightNumber} is not confirmed: ${e.status}`},{status:200})}return a.NextResponse.json({verified:!0},{status:200})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/user/booking/verify/route",pathname:"/api/user/booking/verify",filename:"route",bundlePath:"app/api/user/booking/verify/route"},resolvedPagePath:"/app/app/api/user/booking/verify/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:d,serverHooks:g}=f;function h(){return(0,o.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:d})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},62802:(e,r,t)=>{"use strict";t.d(r,{Er:()=>f,HU:()=>d,HY:()=>g,b9:()=>c,nr:()=>h});var s=t(43205),n=t.n(s),i=t(85663);let o=process.env.ACCESS_SECRET,u=process.env.REFRESH_SECRET,a=process.env.ACCESS_TOKEN_EXPIRY,p=process.env.REFRESH_TOKEN_EXPIRY,l=parseInt(process.env.SALT_ROUNDS,10);function f(e){return i.Ay.hashSync(e,l)}function c(e,r){return i.Ay.compareSync(e,r)}function d(e,r){return r?n().sign(e,o,{expiresIn:a}):n().sign(e,u,{expiresIn:p})}function g(e){return e?x(a):x(p)}function h(e,r){let t;if("object"==typeof e){let r=e.headers.get("Authorization");if(!r)return null;t=r.replace("Bearer ","")}else t=e;try{let e;if((e=r?n().verify(t,o):n().verify(t,u)).exp&&e.exp<Math.floor(Date.now()/1e3))return null;return e}catch{return null}}function x(e){let r;let t=e.slice(-1),s=parseInt(e.slice(0,-1),10);if("s"===t)r=s;else if("m"===t)r=60*s;else if("h"===t)r=3600*s;else if("d"===t)r=86400*s;else throw Error("Unsupported time unit");return r}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97474:(e,r,t)=>{"use strict";t.d(r,{z:()=>s});let s=new(t(96330)).PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,580,5315],()=>t(33990));module.exports=s})();