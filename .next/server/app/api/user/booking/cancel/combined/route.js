(()=>{var e={};e.id=9658,e.ids=[9658],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},40521:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{PATCH:()=>c});var n=r(96559),s=r(48088),i=r(37719),a=r(97474),u=r(32190),l=r(62802);async function c(e){let t=e.cookies.get("token")?.value;if(!t)return u.NextResponse.json({error:"Unauthorized"},{status:401});let r=(0,l.nr)(t,!0);if(!r)return u.NextResponse.json({error:"Invalid token"},{status:403});if("USER"!==r.role&&"HOTEL_OWNER"!==r.role)return u.NextResponse.json({error:"Access Denied"},{status:403});try{let{bookingId:t,cancelType:o}=await e.json();if(!t)return u.NextResponse.json({error:"Missing bookingId"},{status:400});let n=await a.z.booking.findUnique({where:{id:t}});if(!n||n.userId!==r.id)return u.NextResponse.json({error:"Booking not found"},{status:404});let s=null;if(n.hotelId){let e=await a.z.hotel.findUnique({where:{id:n.hotelId}});s=e?.ownerId}let i=n.bookStatus,l={};if("flight"===o)n.hotelId?l.flightBookingInfo=null:l={flightBookingInfo:null,bookStatus:"CANCELLED"};else if("room"===o)n.flightBookingInfo?(l.hotelId=null,l.roomId=null):l={hotelId:null,roomId:null,bookStatus:"CANCELLED"};else{if("both"!==o)return u.NextResponse.json({error:"Invalid cancelType"},{status:400});l={flightBookingInfo:null,hotelId:null,roomId:null,bookStatus:"CANCELLED"}}let c=await a.z.booking.update({where:{id:t},data:l});return("room"===o||"both"===o)&&n.hotelId&&"CONFIRMED"==i&&(await a.z.notification.create({data:{userId:n.userId,message:`⚠️ Booking Update
                        
The room portion of your booking #${n.id} has been cancelled.
                        ${n.flightBookingInfo?"\nYour flight booking remains active.":""}
                        
Please check your email for more details.`}}),s&&await a.z.notification.create({data:{userId:s,message:`⚠️ Booking Cancellation
                            
The room portion of booking #${n.id} has been cancelled by the guest.
                            ${n.checkIn?`
Original check-in: ${new Date(n.checkIn).toLocaleDateString()}`:""}
                            ${n.checkOut?`
Original check-out: ${new Date(n.checkOut).toLocaleDateString()}`:""}`}})),u.NextResponse.json({message:"Booking updated",booking:c},{status:200})}catch(e){return u.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/user/booking/cancel/combined/route",pathname:"/api/user/booking/cancel/combined",filename:"route",bundlePath:"app/api/user/booking/cancel/combined/route"},resolvedPagePath:"/app/app/api/user/booking/cancel/combined/route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:g}=p;function h(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},62802:(e,t,r)=>{"use strict";r.d(t,{Er:()=>p,HU:()=>f,HY:()=>g,b9:()=>d,nr:()=>h});var o=r(43205),n=r.n(o),s=r(85663);let i=process.env.ACCESS_SECRET,a=process.env.REFRESH_SECRET,u=process.env.ACCESS_TOKEN_EXPIRY,l=process.env.REFRESH_TOKEN_EXPIRY,c=parseInt(process.env.SALT_ROUNDS,10);function p(e){return s.Ay.hashSync(e,c)}function d(e,t){return s.Ay.compareSync(e,t)}function f(e,t){return t?n().sign(e,i,{expiresIn:u}):n().sign(e,a,{expiresIn:l})}function g(e){return e?k(u):k(l)}function h(e,t){let r;if("object"==typeof e){let t=e.headers.get("Authorization");if(!t)return null;r=t.replace("Bearer ","")}else r=e;try{let e;if((e=t?n().verify(r,i):n().verify(r,a)).exp&&e.exp<Math.floor(Date.now()/1e3))return null;return e}catch{return null}}function k(e){let t;let r=e.slice(-1),o=parseInt(e.slice(0,-1),10);if("s"===r)t=o;else if("m"===r)t=60*o;else if("h"===r)t=3600*o;else if("d"===r)t=86400*o;else throw Error("Unsupported time unit");return t}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97474:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});let o=new(r(96330)).PrismaClient}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7719,580,5315],()=>r(40521));module.exports=o})();