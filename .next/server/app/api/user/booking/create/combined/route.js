(()=>{var e={};e.id=1252,e.ids=[1252],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},62802:(e,t,r)=>{"use strict";r.d(t,{Er:()=>p,HU:()=>f,HY:()=>h,b9:()=>d,nr:()=>k});var s=r(43205),n=r.n(s),o=r(85663);let i=process.env.ACCESS_SECRET,u=process.env.REFRESH_SECRET,a=process.env.ACCESS_TOKEN_EXPIRY,c=process.env.REFRESH_TOKEN_EXPIRY,l=parseInt(process.env.SALT_ROUNDS,10);function p(e){return o.Ay.hashSync(e,l)}function d(e,t){return o.Ay.compareSync(e,t)}function f(e,t){return t?n().sign(e,i,{expiresIn:a}):n().sign(e,u,{expiresIn:c})}function h(e){return e?x(a):x(c)}function k(e,t){let r;if("object"==typeof e){let t=e.headers.get("Authorization");if(!t)return null;r=t.replace("Bearer ","")}else r=e;try{let e;if((e=t?n().verify(r,i):n().verify(r,u)).exp&&e.exp<Math.floor(Date.now()/1e3))return null;return e}catch{return null}}function x(e){let t;let r=e.slice(-1),s=parseInt(e.slice(0,-1),10);if("s"===r)t=s;else if("m"===r)t=60*s;else if("h"===r)t=3600*s;else if("d"===r)t=86400*s;else throw Error("Unsupported time unit");return t}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},83358:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>d,serverHooks:()=>k,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>p});var n=r(96559),o=r(48088),i=r(37719),u=r(96330),a=r(32190),c=r(62802),l=r(97474);async function p(e){let t=e.cookies.get("token")?.value;if(!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=(0,c.nr)(t,!0);if(!r)return a.NextResponse.json({error:"Invalid token"},{status:403});if("USER"!==r.role&&"HOTEL_OWNER"!==r.role)return a.NextResponse.json({error:"Access Denied"},{status:403});try{let{flightBookingInfo:t,roomBookingInfo:s}=await e.json();if(t)try{JSON.parse(t)}catch(e){return a.NextResponse.json({error:"Invalid flight booking info"},{status:400})}let n=null;if(s)try{n=JSON.parse(s)}catch(e){return a.NextResponse.json({error:"Invalid room booking info"},{status:400})}let o=n&&n.checkIn?new Date(n.checkIn):null,i=n&&n.checkOut?new Date(n.checkOut):null,c=n&&n.hotelId?n.hotelId:null,p=n&&n.roomId?n.roomId:null;if(c&&p){if(!o||!i)return a.NextResponse.json({error:"Missing checkIn or checkOut dates for room booking"},{status:400});if(await l.z.booking.findFirst({where:{roomId:p,bookStatus:{not:u.BookingStatus.CANCELLED},AND:[{checkIn:{lte:i}},{checkOut:{gte:o}}]}}))return a.NextResponse.json({error:"Room is already booked for the selected dates"},{status:400})}let d={user:{connect:{id:r.id}},flightBookingInfo:t||null,checkIn:o,checkOut:i,bookStatus:u.BookingStatus.PENDING,flightStatus:u.FlightStatus.SCHEDULED};c&&p&&(d.hotel={connect:{id:c}},d.room={connect:{id:p}});let f=await l.z.booking.create({data:d});return a.NextResponse.json(f,{status:201})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/user/booking/create/combined/route",pathname:"/api/user/booking/create/combined",filename:"route",bundlePath:"app/api/user/booking/create/combined/route"},resolvedPagePath:"/app/app/api/user/booking/create/combined/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:h,serverHooks:k}=d;function x(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:h})}},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97474:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});let s=new(r(96330)).PrismaClient}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,5315],()=>r(83358));module.exports=s})();