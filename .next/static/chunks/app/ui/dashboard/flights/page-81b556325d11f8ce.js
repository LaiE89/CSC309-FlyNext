(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7870],{2797:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(5155),i=r(2115),a=r(5695),s=r(5550),o=r(9292),l=r(6960);function d(){var e,t;let r=(0,a.useRouter)(),{theme:d}=(0,s.D)(),{userRole:c}=(0,l.J)(),u=(0,a.useSearchParams)().get("location"),[g,h]=(0,i.useState)([]),[b,m]=(0,i.useState)(!1),[p,x]=(0,i.useState)(null),[f,y]=(0,i.useState)("Toronto"),[v,j]=(0,i.useState)(u||"Zurich"),[w,S]=(0,i.useState)(()=>new Date().toISOString().split("T")[0]),[k,N]=(0,i.useState)("one-way"),[E,T]=(0,i.useState)(""),[C,R]=(0,i.useState)([]),[O,I]=(0,i.useState)([]),[P,_]=(0,i.useState)(null),[D,F]=(0,i.useState)(null),[A,L]=(0,i.useState)(null),B=localStorage.getItem("currentBookingId"),U=B?parseInt(B,10):null,H=(0,i.useCallback)(async()=>{m(!0),x(null),_(null),F(null),L(null);try{let e={origin:f,destination:v,date:w,tripType:k};"round-trip"===k&&(e.returnDate=E);let t=new URLSearchParams(e).toString(),n=await fetch("/api/visitor/flights?".concat(t),{method:"GET",credentials:"include"}),i=await n.json();if(!n.ok)throw 440===n.status&&r.push("/ui/error/session-expired"),Error(i.error);h(i)}catch(e){x(e.message||"An unexpected error occurred.")}finally{m(!1)}},[f,v,w,k,E,r]),J=async e=>{try{let t=new URLSearchParams({query:e}).toString(),r=await fetch("/api/visitor/flights/search?".concat(t));if(!r.ok)throw Error("Failed to fetch origin suggestions");let n=await r.json();R(n.suggestions)}catch(e){console.error("Error fetching origin suggestions:",e)}},V=async e=>{try{let t=new URLSearchParams({query:e}).toString(),r=await fetch("/api/visitor/flights/search?".concat(t));if(!r.ok)throw Error("Failed to fetch destination suggestions");let n=await r.json();I(n.suggestions)}catch(e){console.error("Error fetching destination suggestions:",e)}},W=e=>{y(e),R([])},$=e=>{j(e),I([])};(0,i.useEffect)(()=>{H()},[]);let z=async e=>{try{let t,n;let i=JSON.stringify({flights:e.map(e=>({flightid:e.id,flightNumber:e.flightNumber,origin:e.origin.name,destination:e.destination.name,mainDestination:v,airline:e.airline.name,departureTime:e.departureTime,arrivalTime:e.arrivalTime,price:e.price,status:e.status}))});U?(t=await (0,o.v$)("/api/user/booking/edit",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:parseInt(U),flightBookingInfo:i})})).ok||440!==t.status||r.push("/ui/error/session-expired"):((t=await (0,o.v$)("/api/user/booking/create/combined",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({flightBookingInfo:i})})).ok||440!==t.status||r.push("/ui/error/session-expired"),n=await t.json(),localStorage.setItem("currentBookingId",n.id));return}catch(e){throw e}},G=async()=>{try{if(!P){x("Please select a route first.");return}await z(P.flights),r.push("/ui/dashboard/booking")}catch(e){x(e.message||"Failed to create booking. Please try again.")}},K=async()=>{try{if(!D||!A){x("Please select both an outbound and an inbound route.");return}let e=[...D.flights,...A.flights];await z(e),r.push("/ui/dashboard/booking")}catch(e){x(e.message||"Failed to create booking. Please try again.")}},X=(e,t)=>{"outbound"===t?F(t=>t===e?null:e):"inbound"===t?L(t=>t===e?null:e):_(t=>t===e?null:e)},Y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"one-way";return!e||Array.isArray(e)&&0==e.length?(0,n.jsx)("div",{className:"".concat("dark"===d?"text-white":"text-gray-800"),children:"No flights found"}):(Array.isArray(e)?e:e.results||[]).map((e,r)=>{let i=!1;return i="outbound"===t?D===e:"inbound"===t?A===e:P===e,(0,n.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"15px",marginBottom:"15px",backgroundColor:i?"dark"===d?"dimgrey":"gainsboro":"transparent"},children:[(0,n.jsxs)("h3",{children:[e.legs," Leg(s)"]}),(0,n.jsx)("ul",{style:{listStyleType:"none",padding:0},children:e.flights.map((e,t)=>(0,n.jsxs)("li",{style:{marginBottom:"10px",paddingBottom:"10px",borderBottom:"1px solid #eee"},children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Flight Number:"})," ",e.flightNumber]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Airline:"})," ",e.airline.name," (",e.airline.code,")"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Departure:"})," ",e.origin.name," (",e.origin.code,") at"," ",new Date(e.departureTime).toLocaleString()]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Arrival:"})," ",e.destination.name," (",e.destination.code,") at"," ",new Date(e.arrivalTime).toLocaleString()]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Duration:"})," ",Math.floor(e.duration/60),"h ",e.duration%60,"m"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Price:"})," ",e.price," ",e.currency]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Available Seats:"})," ",e.availableSeats]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",e.status]})]},t))}),("USER"===c||"HOTEL_OWNER"===c)&&(0,n.jsx)("button",{onClick:()=>X(e,t),style:{padding:"8px 12px",backgroundColor:"#0070f3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:i?"Unselect":"Select"})]},r)})};return(0,n.jsxs)("div",{className:"max-w-4xl mx-auto p-4 ".concat("dark"===d?"text-white":"text-gray-800"),children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Flight Search"}),(0,n.jsxs)("div",{className:"p-6 rounded-2xl mb-6 transition-all duration-300 ".concat("dark"===d?"bg-gray-800":"bg-white shadow-lg"),children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,n.jsxs)("div",{className:"relative w-full",children:[(0,n.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Origin"}),(0,n.jsx)("input",{type:"text",value:f,onChange:e=>{let t=e.target.value;y(t),""!=t?J(t):R([])},placeholder:"Enter origin city or airport",className:"w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ".concat("dark"===d?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400")}),C.length>0&&(0,n.jsx)("ul",{className:"absolute top-full left-0 right-0 border overflow-y-auto z-10 list-none rounded shadow-md ".concat("dark"===d?"bg-gray-700 border-gray-600 divide-gray-600":"bg-white border-gray-300 divide-gray-200"),children:C.map((e,t)=>(0,n.jsx)("li",{onClick:()=>W(e),className:"p-3 cursor-pointer transition-colors ".concat("dark"===d?"hover:bg-gray-600":"hover:bg-gray-100"),children:e},t))})]}),(0,n.jsxs)("div",{className:"relative w-full",children:[(0,n.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Destination"}),(0,n.jsx)("input",{type:"text",value:v,onChange:e=>{let t=e.target.value;j(t),""!=t?V(t):I([])},placeholder:"Enter destination city or airport",className:"w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ".concat("dark"===d?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400")}),O.length>0&&(0,n.jsx)("ul",{className:"absolute top-full left-0 right-0 border overflow-y-auto z-10 list-none rounded shadow-md ".concat("dark"===d?"bg-gray-700 border-gray-600 divide-gray-600":"bg-white border-gray-300 divide-gray-200"),children:O.map((e,t)=>(0,n.jsx)("li",{onClick:()=>$(e),className:"p-3 cursor-pointer transition-colors ".concat("dark"===d?"hover:bg-gray-600":"hover:bg-gray-100"),children:e},t))})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Trip Type"}),(0,n.jsxs)("select",{value:k,onChange:e=>N(e.target.value),className:"w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ".concat("dark"===d?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400"),children:[(0,n.jsx)("option",{value:"one-way",children:"One Way"}),(0,n.jsx)("option",{value:"round-trip",children:"Round Trip"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Departure Date"}),(0,n.jsx)("input",{type:"date",value:w,onChange:e=>S(e.target.value),className:"w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ".concat("dark"===d?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400")})]}),"round-trip"===k&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Return Date"}),(0,n.jsx)("input",{type:"date",value:E,onChange:e=>T(e.target.value),className:"w-full p-3 rounded-lg border focus:outline-none focus:ring-2 ".concat("dark"===d?"bg-gray-700 border-gray-600 text-white focus:ring-blue-500":"bg-white border-gray-300 focus:ring-blue-400")})]})]}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("button",{onClick:H,disabled:b,className:"w-full md:w-auto px-6 py-3 font-semibold rounded-lg transition-colors ".concat(b?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"," text-white"),children:b?"Searching...":"Search Flights"})})]}),g&&(0,n.jsxs)("div",{className:"p-6 rounded-lg ".concat("dark"===d?"bg-gray-800":"bg-white shadow-md"),children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Available Flights"}),"one-way"===k?(0,n.jsxs)("div",{children:[Y(g),P&&("USER"===c||"HOTEL_OWNER"===c)&&(0,n.jsx)("button",{onClick:G,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Book Selected Flight"})]}):(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Outbound Flights"}),Y((null===(e=g.outbound)||void 0===e?void 0:e.results)||[],"outbound")]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Inbound Flights"}),Y((null===(t=g.inbound)||void 0===t?void 0:t.results)||[],"inbound")]}),D&&A&&("USER"===c||"HOTEL_OWNER"===c)&&(0,n.jsx)("div",{className:"col-span-2",children:(0,n.jsx)("button",{onClick:K,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Book Selected Flights"})})]})]}),p&&(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:p})]})}function c(){return(0,n.jsx)(i.Suspense,{children:(0,n.jsx)(d,{})})}},5550:(e,t,r)=>{"use strict";r.d(t,{D:()=>o,N:()=>s});var n=r(5155),i=r(2115);let a=(0,i.createContext)();function s(e){let{children:t}=e,[r,s]=(0,i.useState)("dark"),[o,l]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{l(!0)},[]),o)?(0,n.jsx)(a.Provider,{value:{theme:r,toggleTheme:()=>{s("dark"===r?"light":"dark")}},children:t}):null}function o(){let e=(0,i.useContext)(a);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6960:(e,t,r)=>{"use strict";r.d(t,{J:()=>o,v:()=>s});var n=r(5155),i=r(2115);let a=(0,i.createContext)();function s(e){let{children:t}=e,[r,s]=(0,i.useState)(null),[o,l]=(0,i.useState)("VISITOR"),[d,c]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{(async function(){try{let e=await fetch("/api/user/profile",{method:"GET",credentials:"include"});if(!e.ok){s(null),l("VISITOR");return}let t=await e.json();s(t),l(t.role||"VISITOR")}catch(e){s(null),l("VISITOR")}})()},[]),(0,n.jsx)(a.Provider,{value:{user:r,userRole:o,setUser:s,setUserRole:l,refreshBadge:()=>{c(!1),setTimeout(()=>{c(!0)},100)}},children:t})}function o(){return(0,i.useContext)(a)}},9027:(e,t,r)=>{Promise.resolve().then(r.bind(r,2797))},9292:(e,t,r)=>{"use strict";r.d(t,{v$:()=>i}),r(8801),r(9980);var n=r(9509);async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch(e,{...t,credentials:"include"});if(401===r.status||403===r.status){if(!await a())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});r=await fetch(e,{...t,credentials:"include"})}return r}n.env.ACCESS_SECRET,n.env.REFRESH_SECRET,n.env.ACCESS_TOKEN_EXPIRY,n.env.REFRESH_TOKEN_EXPIRY,parseInt(n.env.SALT_ROUNDS,10);async function a(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,8441,1684,7358],()=>t(9027)),_N_E=e.O()}]);