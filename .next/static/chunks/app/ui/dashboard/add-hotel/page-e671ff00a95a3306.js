(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4129],{5550:(e,t,a)=>{"use strict";a.d(t,{D:()=>i,N:()=>o});var r=a(5155),s=a(2115);let l=(0,s.createContext)();function o(e){let{children:t}=e,[a,o]=(0,s.useState)("dark"),[i,n]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{n(!0)},[]),i)?(0,r.jsx)(l.Provider,{value:{theme:a,toggleTheme:()=>{o("dark"===a?"light":"dark")}},children:t}):null}function i(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6464:(e,t,a)=>{Promise.resolve().then(a.bind(a,6512))},6512:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var r=a(5155),s=a(2115),l=a(9292),o=a(5695),i=a(5550);function n(){let e=(0,o.useRouter)(),{theme:t}=(0,i.D)(),[a,n]=(0,s.useState)(""),[d,c]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[g,b]=(0,s.useState)(""),[x,m]=(0,s.useState)(1),[p,y]=(0,s.useState)([]),[w,f]=(0,s.useState)(null),[k,v]=(0,s.useState)(!1),[j,N]=(0,s.useState)(""),[S,C]=(0,s.useState)(""),[E,R]=(0,s.useState)([]),[T,O]=(0,s.useState)([]),_=(e,t)=>{let a=e.target.files;a&&("images"===t?y([...p,...Array.from(a)]):f(a[0]))},P=e=>{y(p.filter((t,a)=>a!==e))},H=async e=>{try{let t=new URLSearchParams({query:e}).toString(),a=await fetch("/api/visitor/cities?".concat(t));if(!a.ok)throw Error("Failed to fetch city suggestions");let r=await a.json();R(r.suggestions)}catch(e){console.error(e.message)}},A=async e=>{try{let t=new URLSearchParams({query:e}).toString(),a=await fetch("/api/visitor/countries?".concat(t));if(!a.ok)throw Error("Failed to fetch country suggestions");let r=await a.json();O(r.suggestions)}catch(e){console.error(e.message)}},D=e=>{h(e),R([])},F=e=>{b(e),O([])},$=async t=>{t.preventDefault(),v(!0),N(""),C("");try{let t=null,r=[],s={name:a,address:d,city:u,country:g,starRating:x,logo:t,images:r},o=await (0,l.v$)("/api/user/add-hotel",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),i=await o.json();if(!o.ok)throw 440===o.status&&e.push("/ui/error/session-expired"),Error(i.error);if(w){let a=new FormData;a.append("file",w),a.append("upload-type","hotel-image"),a.append("hotel-id",i.hotel.id);let r=await (0,l.v$)("/api/upload",{method:"POST",credentials:"include",body:a}),s=await r.json();if(!r.ok)throw 440===r.status&&e.push("/ui/error/session-expired"),Error(s.error);t=s.url}for(let t of p){let a=new FormData;a.append("file",t),a.append("upload-type","hotel-image"),a.append("hotel-id",i.hotel.id);let s=await (0,l.v$)("/api/upload",{method:"POST",credentials:"include",body:a}),o=await s.json();if(!s.ok)throw 440===s.status&&e.push("/ui/error/session-expired"),Error(o.error);r.push(o.url)}o=await (0,l.v$)("/api/user/add-hotel",{method:"PATCH",body:JSON.stringify({id:i.hotel.id,images:r,logo:t})});let k=await o.json();if(!o.ok)throw 440===o.status&&e.push("/ui/error/session-expired"),Error(k.error);i.isRoleChanged?(C("Hotel added successfully! Role has been changed so redirecting to login..."),setTimeout(()=>e.push("/ui/login"),2e3)):C("Hotel added successfully!"),n(""),c(""),h(""),b(""),m(1),y([]),f(null)}catch(e){N(e.message||"An unexpected error occurred.")}finally{v(!1)}};return(0,r.jsxs)("div",{className:"max-w-md mx-auto mt-10 shadow-md rounded-2xl p-6 text-center space-y-6 ".concat("dark"===t?"bg-gray-800 text-white":"bg-white text-gray-800"),children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4 ".concat("dark"===t?"text-white":"text-black"),children:"Add a New Hotel"}),(0,r.jsxs)("form",{onSubmit:$,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"Hotel Name"}),(0,r.jsx)("input",{type:"text",value:a,onChange:e=>n(e.target.value),required:!0,className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"Address"}),(0,r.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),required:!0,className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"City"}),(0,r.jsxs)("div",{className:"relative w-full",children:[(0,r.jsx)("input",{type:"text",value:u,onChange:e=>{let t=e.target.value;h(t),""!=t?H(t):R([])},required:!0,className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")}),E.length>0&&(0,r.jsx)("ul",{className:"absolute top-full left-0 right-0 border overflow-y-auto z-10 list-none rounded shadow-md \n                                ".concat("dark"===t?"bg-gray-800 border-gray-600":"bg-white border-gray-300"),children:E.map((e,a)=>(0,r.jsx)("li",{onClick:()=>D(e),className:"p-2 cursor-pointer hover:bg-gray-100 ".concat("dark"===t?"hover:bg-gray-700":"hover:bg-gray-100"),children:e},a))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"Country"}),(0,r.jsxs)("div",{className:"relative w-full",children:[(0,r.jsx)("input",{type:"text",value:g,onChange:e=>{let t=e.target.value;b(t),""!=t?A(t):O([])},required:!0,className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")}),T.length>0&&(0,r.jsx)("ul",{className:"absolute top-full left-0 right-0 border overflow-y-auto z-10 list-none rounded shadow-md \n                                ".concat("dark"===t?"bg-gray-800 border-gray-600":"bg-white border-gray-300"),children:T.map((e,a)=>(0,r.jsx)("li",{onClick:()=>F(e),className:"p-2 cursor-pointer hover:bg-gray-100 ".concat("dark"===t?"hover:bg-gray-700":"hover:bg-gray-100"),children:e},a))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"Star Rating"}),(0,r.jsx)("select",{value:x,onChange:e=>m(Number(e.target.value)),className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300"),children:[1,2,3,4,5].map(e=>(0,r.jsxs)("option",{value:e,children:[e," Star",1!==e?"s":""]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"Hotel Images (Optional)"}),(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>_(e,"images"),className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")}),p.length>0&&(0,r.jsx)("div",{className:"mt-2 space-y-1",children:p.map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm truncate ".concat("dark"===t?"text-white":"text-black"),children:e.name}),(0,r.jsx)("button",{type:"button",onClick:()=>P(a),className:"text-red-500 text-sm hover:underline",children:"Remove"})]},a))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium ".concat("dark"===t?"text-white":"text-black"),children:"Hotel Logo (Optional)"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>_(e,"logo"),className:"w-full p-2 border rounded ".concat("dark"===t?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")}),w&&(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm truncate ".concat("dark"===t?"text-white":"text-black"),children:w.name}),(0,r.jsx)("button",{type:"button",onClick:()=>{f(null)},className:"text-red-500 text-sm hover:underline",children:"Remove"})]})]}),(0,r.jsx)("button",{type:"submit",disabled:k,className:"w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600",children:k?"Submitting...":"Add Hotel"})]}),j&&(0,r.jsx)("div",{className:"p-4 rounded-lg ".concat("dark"===t?"bg-red-900/50":"bg-red-100"),children:(0,r.jsx)("p",{className:"text-red-500",children:j})}),S&&(0,r.jsx)("div",{className:"p-4 rounded-lg ".concat("dark"===t?"bg-green-900/50":"bg-green-100"),children:(0,r.jsx)("p",{className:"text-green-500",children:S})})]})}},9292:(e,t,a)=>{"use strict";a.d(t,{v$:()=>s}),a(8801),a(9980);var r=a(9509);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await fetch(e,{...t,credentials:"include"});if(401===a.status||403===a.status){if(!await l())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});a=await fetch(e,{...t,credentials:"include"})}return a}r.env.ACCESS_SECRET,r.env.REFRESH_SECRET,r.env.ACCESS_TOKEN_EXPIRY,r.env.REFRESH_TOKEN_EXPIRY,parseInt(r.env.SALT_ROUNDS,10);async function l(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,8441,1684,7358],()=>t(6464)),_N_E=e.O()}]);