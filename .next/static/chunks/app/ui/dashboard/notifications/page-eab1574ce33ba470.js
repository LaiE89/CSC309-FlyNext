(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3517],{1384:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),s=r(2115),i=r(9292),n=r(5695),o=r(5550);let l=(e,t)=>{let r;return function(){for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];clearTimeout(r),r=setTimeout(()=>e(...s),t)}};function c(){let e=(0,n.useRouter)(),{theme:t}=(0,o.D)(),[r,c]=(0,s.useState)(0),[u,d]=(0,s.useState)(!0),[h,f]=(0,s.useState)(null),x=(0,s.useCallback)(async()=>{try{d(!0);let t=await (0,i.v$)("/api/user/notifications/badge");if(!t.ok){if(440===t.status){e.push("/ui/error/session-expired");return}throw Error("Failed to fetch unread notifications count")}let r=await t.json();c(r.unreadCount||0),f(null)}catch(e){console.error("Error fetching unread notifications count:",e),f(e.message)}finally{d(!1)}},[e]),m=(0,s.useCallback)(()=>l(x,1e3)(),[x]);return(0,s.useEffect)(()=>{let e,t=!0,r=()=>{t&&(m(),e=setTimeout(r,3e4))};return m(),e=setTimeout(r,3e4),()=>{t=!1,e&&clearTimeout(e)}},[m]),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("div",{title:"Notifications",className:"p-2 rounded-full transition-colors ".concat("dark"===t?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-200 text-gray-600"),children:[(0,a.jsx)("svg",{className:"w-5 h-5 ".concat("dark"===t?"text-white":"text-gray-800"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),!u&&!h&&r>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full animate-pulse",children:r})]})})}},2424:(e,t,r)=>{Promise.resolve().then(r.bind(r,9336))},5550:(e,t,r)=>{"use strict";r.d(t,{D:()=>o,N:()=>n});var a=r(5155),s=r(2115);let i=(0,s.createContext)();function n(e){let{children:t}=e,[r,n]=(0,s.useState)("dark"),[o,l]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{l(!0)},[]),o)?(0,a.jsx)(i.Provider,{value:{theme:r,toggleTheme:()=>{n("dark"===r?"light":"dark")}},children:t}):null}function o(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6960:(e,t,r)=>{"use strict";r.d(t,{J:()=>o,v:()=>n});var a=r(5155),s=r(2115);let i=(0,s.createContext)();function n(e){let{children:t}=e,[r,n]=(0,s.useState)(null),[o,l]=(0,s.useState)("VISITOR"),[c,u]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async function(){try{let e=await fetch("/api/user/profile",{method:"GET",credentials:"include"});if(!e.ok){n(null),l("VISITOR");return}let t=await e.json();n(t),l(t.role||"VISITOR")}catch(e){n(null),l("VISITOR")}})()},[]),(0,a.jsx)(i.Provider,{value:{user:r,userRole:o,setUser:n,setUserRole:l,refreshBadge:()=>{u(!1),setTimeout(()=>{u(!0)},100)}},children:t})}function o(){return(0,s.useContext)(i)}},9292:(e,t,r)=>{"use strict";r.d(t,{v$:()=>s}),r(8801),r(9980);var a=r(9509);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch(e,{...t,credentials:"include"});if(401===r.status||403===r.status){if(!await i())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});r=await fetch(e,{...t,credentials:"include"})}return r}a.env.ACCESS_SECRET,a.env.REFRESH_SECRET,a.env.ACCESS_TOKEN_EXPIRY,a.env.REFRESH_TOKEN_EXPIRY,parseInt(a.env.SALT_ROUNDS,10);async function i(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9336:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),s=r(2115),i=r(5695),n=r(9292),o=r(1384),l=r(5550),c=r(6960);function u(){let e=(0,i.useRouter)(),{theme:t}=(0,l.D)(),{refreshBadge:r}=(0,c.J)(),[u,d]=(0,s.useState)([]),[h,f]=(0,s.useState)(null),[x,m]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{let t=await (0,n.v$)("/api/user/notifications/recieve",{method:"GET",credentials:"include"});if(!t.ok)throw 440===t.status&&e.push("/ui/error/session-expired"),Error("Failed to fetch notifications");let r=await t.json();d(r)}catch(e){f(e.message)}})()},[e]);let g=async t=>{try{let a=await (0,n.v$)("/api/user/notifications/read",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationIds:[t]})});if(!a.ok)throw 440===a.status&&e.push("/ui/error/session-expired"),Error("Failed to mark notification as read");d(e=>e.map(e=>e.id===t?{...e,isRead:!0}:e)),r(),m(!1),setTimeout(()=>{m(!0)},100)}catch(e){f(e.message)}},v=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800 ".concat("dark"===t?"text-white":"text-gray-800"),children:"Notifications"}),x&&(0,a.jsx)(o.default,{},x)]}),h&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:h}),0===u.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:"No notifications found."})}):(0,a.jsx)("div",{className:"space-y-4",children:u.map(e=>(0,a.jsx)("div",{className:"p-6 rounded-lg shadow-sm transition-all duration-200 ".concat(e.isRead?"bg-gray-50 dark:bg-gray-800":"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500"),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-lg ".concat(e.isRead?"text-gray-700 dark:text-gray-300":"text-gray-900 dark:text-white font-medium"),children:e.message}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:v(e.createdAt)})]}),!e.isRead&&(0,a.jsx)("button",{onClick:()=>g(e.id),className:"ml-4 px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Mark as Read"})]})},e.id))})]})}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,8441,1684,7358],()=>t(2424)),_N_E=e.O()}]);