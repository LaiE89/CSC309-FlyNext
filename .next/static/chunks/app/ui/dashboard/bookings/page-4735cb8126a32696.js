(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8279],{1332:(e,t,n)=>{Promise.resolve().then(n.bind(n,3204))},3204:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var a=n(5155),r=n(2115),s=n(5695),i=n(9292),l=n(5550);function o(){let e=(0,s.useRouter)(),{theme:t}=(0,l.D)(),[n,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(null),[h,u]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[g,p]=(0,r.useState)([]),f=(0,r.useCallback)(async()=>{u(!0);try{let t=await (0,i.v$)("/api/user/booking/user",{method:"GET",credentials:"include"}),n=await t.json();if(!t.ok)throw 440===t.status&&e.push("/ui/error/session-expired"),Error(n.error);n.sort((e,t)=>e.id<t.id?1:-1),o(n)}catch(e){d(e.message||"An unexpected error occurred.")}finally{u(!1)}},[e]);(0,r.useEffect)(()=>{f()},[]);let b=async t=>{u(!0);try{let n=await (0,i.v$)("/api/user/booking/verify?bookingId=".concat(encodeURIComponent(t)),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),a=await n.json();if(!n.ok)throw 440===n.status&&e.push("/ui/error/session-expired"),Error(a.error);x(a.message||"Verification complete"),p(e=>[...e,Number(t)])}catch(e){d(e.message||"An unexpected error occurred.")}finally{u(!1)}},N=async t=>{"PENDING"===t.bookStatus&&(localStorage.setItem("currentBookingId",t.id),e.push("/ui/dashboard/booking"))},w=async(t,n)=>{u(!0);try{let a=await (0,i.v$)("/api/user/booking/cancel/combined",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:t,cancelType:n})}),r=await a.json();if(!a.ok)throw 440===a.status&&e.push("/ui/error/session-expired"),Error(r.error||"Failed to cancel booking portion");await f(),("flight"===n||"both"===n)&&p(e=>e.filter(e=>Number(e)!==Number(t)))}catch(e){d(e.message||"An unexpected error occurred.")}finally{u(!1)}},j=e=>{w(e,"flight")},k=e=>{w(e,"room")},y=e=>{w(e,"both")},v=e=>e.flightBookingInfo?"Flight Scheduled":"No Flight Booked",E=e=>e.hotelId?"Hotel Booked":"No Hotel Booked",S=e=>{let t="";if(e.flightBookingInfo)try{let n=JSON.parse(e.flightBookingInfo);if(n.flights&&n.flights.length>0){let e=n.flights[0],a=n.flights[n.flights.length-1];t="".concat(new Date(e.departureTime).toLocaleDateString()," - ").concat(new Date(a.arrivalTime).toLocaleDateString())}}catch(e){t="Invalid flight data"}let n="";return e.checkIn&&e.checkOut&&(n="".concat(new Date(e.checkIn).toLocaleDateString()," - ").concat(new Date(e.checkOut).toLocaleDateString())),(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsxs)("div",{children:["Flight Dates: ",t]},"flight-".concat(e.id)),n&&(0,a.jsxs)("div",{children:["Hotel Dates: ",n]},"hotel-".concat(e.id)),!t&&!n&&(0,a.jsx)("div",{children:"N/A"},"none-".concat(e.id))]})};return h?(0,a.jsx)("div",{className:"flex justify-center items-center h-64 ".concat("dark"===t?"text-white":"text-gray-800"),children:(0,a.jsx)("div",{className:"text-lg font-medium animate-pulse",children:"Loading Bookings..."})}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-4 ".concat("dark"===t?"text-white":"text-gray-800"),children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"My Bookings"}),c&&(0,a.jsxs)("p",{className:"text-red-500",children:["Error: ",c]}),m&&(0,a.jsx)("p",{className:"text-blue-500",children:m}),0===n.length?(0,a.jsx)("p",{children:"No bookings found."}):(0,a.jsx)("div",{className:"overflow-y-auto max-h-[700px]",children:(0,a.jsxs)("table",{className:"w-full border-collapse table-auto",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"".concat("dark"===t?"bg-gray-800":"bg-gray-100"),children:[(0,a.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Booking ID"}),(0,a.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Status"}),(0,a.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Flight"}),(0,a.jsx)("th",{className:"p-3 text-left min-w-[100px]",children:"Hotel"}),(0,a.jsx)("th",{className:"p-3 text-left min-w-[220px] whitespace-nowrap",children:"Dates"}),(0,a.jsx)("th",{className:"p-3 text-left min-w-[170px]",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:n.map(e=>{let{id:n,flightBookingInfo:r,hotelId:s,bookStatus:i}=e,l=v(e),o=E(e);"".concat(l," / ").concat(o);let c="CANCELLED"===i,d=g.includes(Number(n));return(0,a.jsxs)("tr",{className:"border-t ".concat("dark"===t?"border-gray-700":"border-gray-200"),children:[(0,a.jsxs)("td",{className:"p-2",children:[n,d&&(0,a.jsx)("span",{className:"text-blue-500 ml-1",children:"(Verified)"})]}),(0,a.jsx)("td",{className:"p-2",children:i}),(0,a.jsx)("td",{className:"p-2",children:l}),(0,a.jsx)("td",{className:"p-2",children:o}),(0,a.jsx)("td",{className:"p-2",children:S(e)}),(0,a.jsx)("td",{className:"p-2",children:c?(0,a.jsx)("span",{className:"text-gray-500",children:"No actions available"}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[r&&!d&&(0,a.jsx)("button",{onClick:()=>b(n),className:"w-48 min-w-[12rem] px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-all text-center",children:"Verify Flights"}),"PENDING"===i&&(0,a.jsx)("button",{onClick:()=>N(e),className:"w-48 min-w-[12rem] px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-all text-center",children:"Complete Booking"}),r&&(0,a.jsx)("button",{onClick:()=>j(n),className:"w-48 min-w-[12rem] px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-all text-center",children:"Cancel Flights"}),s&&(0,a.jsx)("button",{onClick:()=>k(n),className:"w-48 min-w-[12rem] px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-all text-center",children:"Cancel Hotels"}),(0,a.jsx)("button",{onClick:()=>y(n),className:"w-48 min-w-[12rem] px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-all text-center",children:"Cancel Entire Booking"})]})})})]},n)})})]})})]})}},5550:(e,t,n)=>{"use strict";n.d(t,{D:()=>l,N:()=>i});var a=n(5155),r=n(2115);let s=(0,r.createContext)();function i(e){let{children:t}=e,[n,i]=(0,r.useState)("dark"),[l,o]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{o(!0)},[]),l)?(0,a.jsx)(s.Provider,{value:{theme:n,toggleTheme:()=>{i("dark"===n?"light":"dark")}},children:t}):null}function l(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},9292:(e,t,n)=>{"use strict";n.d(t,{v$:()=>r}),n(8801),n(9980);var a=n(9509);async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch(e,{...t,credentials:"include"});if(401===n.status||403===n.status){if(!await s())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});n=await fetch(e,{...t,credentials:"include"})}return n}a.env.ACCESS_SECRET,a.env.REFRESH_SECRET,a.env.ACCESS_TOKEN_EXPIRY,a.env.REFRESH_TOKEN_EXPIRY,parseInt(a.env.SALT_ROUNDS,10);async function s(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,8441,1684,7358],()=>t(1332)),_N_E=e.O()}]);