(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3820],{1253:(e,t,a)=>{Promise.resolve().then(a.bind(a,1939))},1939:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var r=a(5155),s=a(2115),l=a(5695),n=a(9292),i=a(6960),c=a(5550),d=a(6766);function o(){let e=(0,l.useRouter)(),{user:t,setUser:a}=(0,i.J)(),{theme:o}=(0,c.D)(),[u,x]=(0,s.useState)(null),[h,m]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null),[f,y]=(0,s.useState)(null),[b,N]=(0,s.useState)({firstName:"",lastName:"",profilePicture:"",phone:""});(0,s.useEffect)(()=>{N({firstName:(null==t?void 0:t.firstName)||"",lastName:(null==t?void 0:t.lastName)||"",profilePicture:(null==t?void 0:t.profilePicture)||"",phone:(null==t?void 0:t.phone)||""})},[t]);let j=e=>{N(t=>({...t,[e.target.name]:e.target.value}))},v=async r=>{r.preventDefault();let s=t.profilePicture;if(g)try{let t=new FormData;t.append("file",g),t.append("upload-type","profile-picture");let a=await (0,n.v$)("/api/upload",{method:"POST",credentials:"include",body:t}),r=await a.json();if(!a.ok)throw 440===a.status&&e.push("/ui/error/session-expired"),Error(r.error);s=r.url}catch(e){x(e.message||"An unexpected error occurred.");return}try{let t=await (0,n.v$)("/api/user/profile",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({...b,profilePicture:s})}),r=await t.json();if(!t.ok)throw 440===t.status&&e.push("/ui/error/session-expired"),Error(r.error);a(r),m(!1),p(null),y(null)}catch(e){x(e.message||"An unexpected error occurred.")}};return(0,r.jsxs)("div",{className:"max-w-md mx-auto mt-10 shadow-md rounded-2xl p-6 text-center space-y-6 ".concat("dark"===o?"bg-gray-800 text-white":"bg-white text-gray-800"),children:[(0,r.jsx)("h1",{className:"text-2xl font-bold ".concat("dark"===o?"text-white":"text-gray-800"),children:"My Profile"}),u&&(0,r.jsx)("p",{className:"text-red-500 font-medium",children:u}),t?(0,r.jsx)("div",{className:"space-y-4",children:h?(0,r.jsxs)("form",{onSubmit:v,className:"grid gap-4 text-left",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"font-semibold ".concat("dark"===o?"text-gray-300":"text-gray-800"),children:"First Name"}),(0,r.jsx)("input",{type:"text",name:"firstName",value:b.firstName,onChange:j,className:"border rounded px-3 py-2 ".concat("dark"===o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-black")})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"font-semibold ".concat("dark"===o?"text-gray-300":"text-gray-800"),children:"Last Name"}),(0,r.jsx)("input",{type:"text",name:"lastName",value:b.lastName,onChange:j,className:"border rounded px-3 py-2 ".concat("dark"===o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-black")})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"font-semibold ".concat("dark"===o?"text-gray-300":"text-gray-800"),children:"Phone Number"}),(0,r.jsx)("input",{type:"tel",name:"phone",pattern:"[0-9]{3}-[0-9]{3}-[0-9]{4}",value:b.phone,onChange:j,className:"border rounded px-3 py-2 ".concat("dark"===o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-black")})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"font-semibold ".concat("dark"===o?"text-gray-300":"text-gray-800"),children:"Profile Picture"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];t?(p(t),y(URL.createObjectURL(t))):(p(null),y(null))},className:"text-sm ".concat("dark"===o?"text-gray-300":"text-gray-800")})]}),(0,r.jsx)("div",{className:"flex justify-center",children:f?(0,r.jsx)(d.default,{src:f,alt:"Preview",width:256,height:256,className:"rounded-full object-cover w-48 h-48 border-4 shadow-md ".concat("dark"===o?"border-gray-600":"border-gray-300")}):t.profilePicture?(0,r.jsx)(d.default,{src:t.profilePicture,alt:"Current",width:256,height:256,className:"rounded-full object-cover w-48 h-48 border-4 shadow-md ".concat("dark"===o?"border-gray-600":"border-gray-300")}):(0,r.jsx)("span",{className:"dark"===o?"text-gray-300":"text-gray-800",children:"No picture"})}),(0,r.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,r.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:"Save"}),(0,r.jsx)("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 rounded-lg transition ".concat("dark"===o?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-300 text-gray-800 hover:bg-gray-400"),children:"Cancel"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6",children:[(0,r.jsx)("div",{className:"w-48 h-48",children:(0,r.jsx)(d.default,{src:t.profilePicture||"/default-profile.png",alt:"Profile",width:256,height:256,className:"rounded-full object-cover w-48 h-48 border-4 shadow-md ".concat("dark"===o?"border-gray-600":"border-gray-300")})}),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold ".concat("dark"===o?"text-gray-400":"text-gray-500"),children:"First Name"}),(0,r.jsx)("p",{className:"dark"===o?"text-gray-300":"text-gray-800",children:t.firstName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold ".concat("dark"===o?"text-gray-400":"text-gray-500"),children:"Last Name"}),(0,r.jsx)("p",{className:"dark"===o?"text-gray-300":"text-gray-800",children:t.lastName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold ".concat("dark"===o?"text-gray-400":"text-gray-500"),children:"Email"}),(0,r.jsx)("p",{className:"text-base break-all ".concat("dark"===o?"text-gray-300":"text-gray-800"),children:t.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold ".concat("dark"===o?"text-gray-400":"text-gray-500"),children:"Role"}),(0,r.jsx)("p",{className:"dark"===o?"text-gray-300":"text-gray-800",children:"HOTEL_OWNER"==t.role?"Hotel Owner":"User"})]}),(0,r.jsxs)("div",{className:"sm:col-span-2",children:[(0,r.jsx)("p",{className:"text-sm font-semibold ".concat("dark"===o?"text-gray-400":"text-gray-500"),children:"Phone Number"}),(0,r.jsx)("p",{className:"dark"===o?"text-gray-300":"text-gray-800",children:t.phone?t.phone:"None"})]})]})})]}),(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-3 mt-2",children:(0,r.jsx)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:"Edit Profile"})})]})}):(0,r.jsx)("p",{className:"dark"===o?"text-gray-300":"text-gray-800",children:"Loading..."})]})}},5550:(e,t,a)=>{"use strict";a.d(t,{D:()=>i,N:()=>n});var r=a(5155),s=a(2115);let l=(0,s.createContext)();function n(e){let{children:t}=e,[a,n]=(0,s.useState)("dark"),[i,c]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{c(!0)},[]),i)?(0,r.jsx)(l.Provider,{value:{theme:a,toggleTheme:()=>{n("dark"===a?"light":"dark")}},children:t}):null}function i(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6960:(e,t,a)=>{"use strict";a.d(t,{J:()=>i,v:()=>n});var r=a(5155),s=a(2115);let l=(0,s.createContext)();function n(e){let{children:t}=e,[a,n]=(0,s.useState)(null),[i,c]=(0,s.useState)("VISITOR"),[d,o]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async function(){try{let e=await fetch("/api/user/profile",{method:"GET",credentials:"include"});if(!e.ok){n(null),c("VISITOR");return}let t=await e.json();n(t),c(t.role||"VISITOR")}catch(e){n(null),c("VISITOR")}})()},[]),(0,r.jsx)(l.Provider,{value:{user:a,userRole:i,setUser:n,setUserRole:c,refreshBadge:()=>{o(!1),setTimeout(()=>{o(!0)},100)}},children:t})}function i(){return(0,s.useContext)(l)}},9292:(e,t,a)=>{"use strict";a.d(t,{v$:()=>s}),a(8801),a(9980);var r=a(9509);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await fetch(e,{...t,credentials:"include"});if(401===a.status||403===a.status){if(!await l())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});a=await fetch(e,{...t,credentials:"include"})}return a}r.env.ACCESS_SECRET,r.env.REFRESH_SECRET,r.env.ACCESS_TOKEN_EXPIRY,r.env.REFRESH_TOKEN_EXPIRY,parseInt(r.env.SALT_ROUNDS,10);async function l(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,6766,8441,1684,7358],()=>t(1253)),_N_E=e.O()}]);