(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1801],{1384:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),l=r(2115),s=r(9292),n=r(5695),i=r(5550);let o=(e,t)=>{let r;return function(){for(var a=arguments.length,l=Array(a),s=0;s<a;s++)l[s]=arguments[s];clearTimeout(r),r=setTimeout(()=>e(...l),t)}};function c(){let e=(0,n.useRouter)(),{theme:t}=(0,i.D)(),[r,c]=(0,l.useState)(0),[d,h]=(0,l.useState)(!0),[u,x]=(0,l.useState)(null),g=(0,l.useCallback)(async()=>{try{h(!0);let t=await (0,s.v$)("/api/user/notifications/badge");if(!t.ok){if(440===t.status){e.push("/ui/error/session-expired");return}throw Error("Failed to fetch unread notifications count")}let r=await t.json();c(r.unreadCount||0),x(null)}catch(e){console.error("Error fetching unread notifications count:",e),x(e.message)}finally{h(!1)}},[e]),f=(0,l.useCallback)(()=>o(g,1e3)(),[g]);return(0,l.useEffect)(()=>{let e,t=!0,r=()=>{t&&(f(),e=setTimeout(r,3e4))};return f(),e=setTimeout(r,3e4),()=>{t=!1,e&&clearTimeout(e)}},[f]),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("div",{title:"Notifications",className:"p-2 rounded-full transition-colors ".concat("dark"===t?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-200 text-gray-600"),children:[(0,a.jsx)("svg",{className:"w-5 h-5 ".concat("dark"===t?"text-white":"text-gray-800"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),!d&&!u&&r>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full animate-pulse",children:r})]})})}},5550:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,N:()=>n});var a=r(5155),l=r(2115);let s=(0,l.createContext)();function n(e){let{children:t}=e,[r,n]=(0,l.useState)("dark"),[i,o]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{o(!0)},[]),i)?(0,a.jsx)(s.Provider,{value:{theme:r,toggleTheme:()=>{n("dark"===r?"light":"dark")}},children:t}):null}function i(){let e=(0,l.useContext)(s);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6960:(e,t,r)=>{"use strict";r.d(t,{J:()=>i,v:()=>n});var a=r(5155),l=r(2115);let s=(0,l.createContext)();function n(e){let{children:t}=e,[r,n]=(0,l.useState)(null),[i,o]=(0,l.useState)("VISITOR"),[c,d]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async function(){try{let e=await fetch("/api/user/profile",{method:"GET",credentials:"include"});if(!e.ok){n(null),o("VISITOR");return}let t=await e.json();n(t),o(t.role||"VISITOR")}catch(e){n(null),o("VISITOR")}})()},[]),(0,a.jsx)(s.Provider,{value:{user:r,userRole:i,setUser:n,setUserRole:o,refreshBadge:()=>{d(!1),setTimeout(()=>{d(!0)},100)}},children:t})}function i(){return(0,l.useContext)(s)}},7508:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),l=r(2115),s=r(6960),n=r(5550),i=r(5695),o=r(6766),c=r(6874),d=r.n(c),h=r(1384);function u(e){let{children:t}=e;return(0,a.jsx)(n.N,{children:(0,a.jsx)(s.v,{children:(0,a.jsx)(x,{children:t})})})}function x(e){let{children:t}=e,r=(0,i.useRouter)(),{userRole:c}=(0,s.J)(),{theme:u,toggleTheme:x}=(0,n.D)(),[g,f]=(0,l.useState)(!1),v=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),localStorage.clear(),r.push("/ui/login")}catch(e){console.error("Failed to logout:",e)}},m=async()=>{r.push("/ui/dashboard/booking")};return(0,a.jsxs)("div",{className:"flex flex-col h-screen ".concat("dark"===u?"bg-gray-900":"bg-gray-100"),children:[(0,a.jsxs)("nav",{className:"w-full ".concat("dark"===u?"bg-gray-800":"bg-white shadow-md"," p-4 flex justify-between items-center"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.default,{src:"/flynext.png",alt:"FlyNext logo",width:256,height:256,className:"w-6 h-auto"}),(0,a.jsx)("h2",{className:"text-xl font-bold ".concat("dark"===u?"text-white":"text-gray-800"),children:"FlyNext"})]}),(0,a.jsx)("div",{className:"hidden lg:block",children:(0,a.jsxs)("ul",{className:"flex items-center space-x-4",children:[(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:x,className:"p-2 rounded-full transition-colors ".concat("dark"===u?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-200 text-gray-600"),title:"Switch to ".concat("dark"===u?"light":"dark"," mode"),children:"dark"===u?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})})}),("USER"===c||"HOTEL_OWNER"===c)&&(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/notifications",className:"relative",children:(0,a.jsx)(h.default,{},Date.now())})}),("USER"===c||"HOTEL_OWNER"===c)&&(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:m,className:"p-2 rounded-full transition-colors ".concat("dark"===u?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-200 text-gray-600"),title:"View Current Booking",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3h2l.4 2m1.2 6h11.45a1 1 0 00.98-.8l1.2-6A1 1 0 0019.3 3H6.21M6.6 11l1.5 7.5a1 1 0 00.99.8h8.82a1 1 0 00.98-.8L21 8H7"}),(0,a.jsx)("circle",{cx:"9",cy:"20",r:"1.5"}),(0,a.jsx)("circle",{cx:"17",cy:"20",r:"1.5"})]})})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:v,className:"hover:underline cursor-pointer ".concat("dark"===u?"text-white":"text-gray-800"),children:"Logout"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/flights",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"Flights"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/all-hotels",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"All Hotels"})}),("USER"===c||"HOTEL_OWNER"===c)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/bookings",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"My Bookings"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/profile",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"Profile"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/add-hotel",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"Add Hotel"})})]}),"HOTEL_OWNER"===c&&(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/my-hotels",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"My Hotels"})})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 lg:hidden",children:[(0,a.jsx)("button",{onClick:x,className:"p-2 rounded-full transition-colors ".concat("dark"===u?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-200 text-gray-600"),title:"Switch to ".concat("dark"===u?"light":"dark"," mode"),children:"dark"===u?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),("USER"===c||"HOTEL_OWNER"===c)&&(0,a.jsx)(d(),{href:"/ui/dashboard/notifications",className:"relative",children:(0,a.jsx)(h.default,{},Date.now())}),(0,a.jsx)("button",{onClick:()=>{f(e=>!e)},className:"p-2 rounded-full transition-colors ".concat("dark"===u?"hover:bg-gray-700":"hover:bg-gray-200"),children:g?(0,a.jsx)("svg",{className:"w-6 h-6 ".concat("dark"===u?"text-white":"text-gray-800"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,a.jsx)("svg",{className:"w-6 h-6 ".concat("dark"===u?"text-white":"text-gray-800"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),g&&(0,a.jsx)("div",{className:"lg:hidden ".concat("dark"===u?"bg-gray-800":"bg-white shadow-md"," px-6 py-4 space-y-2"),children:(0,a.jsxs)("ul",{className:"flex flex-col gap-3 items-center text-center",children:[(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:v,className:"hover:underline cursor-pointer ".concat("dark"===u?"text-white":"text-gray-800"),children:"Logout"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/flights",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"Flights"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/all-hotels",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"All Hotels"})}),("USER"===c||"HOTEL_OWNER"===c)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/bookings",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"My Bookings"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/profile",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"Profile"})}),(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/add-hotel",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"Add Hotel"})})]}),"HOTEL_OWNER"===c&&(0,a.jsx)("li",{children:(0,a.jsx)(d(),{href:"/ui/dashboard/my-hotels",className:"hover:underline ".concat("dark"===u?"text-white":"text-gray-800"),children:"My Hotels"})})]})}),(0,a.jsx)("main",{className:"flex-1 p-4 ".concat("dark"===u?"bg-gray-900":"bg-gray-100"),children:t})]})}},9292:(e,t,r)=>{"use strict";r.d(t,{v$:()=>l}),r(8801),r(9980);var a=r(9509);async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch(e,{...t,credentials:"include"});if(401===r.status||403===r.status){if(!await s())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});r=await fetch(e,{...t,credentials:"include"})}return r}a.env.ACCESS_SECRET,a.env.REFRESH_SECRET,a.env.ACCESS_TOKEN_EXPIRY,a.env.REFRESH_TOKEN_EXPIRY,parseInt(a.env.SALT_ROUNDS,10);async function s(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9358:(e,t,r)=>{Promise.resolve().then(r.bind(r,7508))},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,6766,6874,8441,1684,7358],()=>t(9358)),_N_E=e.O()}]);