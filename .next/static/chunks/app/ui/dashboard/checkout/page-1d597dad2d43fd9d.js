(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6743],{3856:(e,t,r)=>{Promise.resolve().then(r.bind(r,7200))},5550:(e,t,r)=>{"use strict";r.d(t,{D:()=>l,N:()=>o});var a=r(5155),n=r(2115);let s=(0,n.createContext)();function o(e){let{children:t}=e,[r,o]=(0,n.useState)("dark"),[l,i]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{i(!0)},[]),l)?(0,a.jsx)(s.Provider,{value:{theme:r,toggleTheme:()=>{o("dark"===r?"light":"dark")}},children:t}):null}function l(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},7200:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),n=r(2115),s=r(5695),o=r(9292),l=r(5550);function i(){let e=(0,s.useSearchParams)().get("bookingId"),[t,r]=(0,n.useState)(""),[i,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(null),[h,g]=(0,n.useState)(""),[x,m]=(0,n.useState)(null),[b,p]=(0,n.useState)(!1),f=(0,s.useRouter)(),{theme:y}=(0,l.D)();(0,n.useEffect)(()=>{console.log("Checkout Page: Booking ID from URL:",e)},[e]);let k=async r=>{r.preventDefault(),u(null),g(""),m(null);let a=t.trim();if(!/^\d{16}$/.test(a)){u("Incorrect card number");return}p(!0),console.log("Checkout Page: Sending payload:",{bookingId:e,cardNumber:t,expiryDate:i});try{let t=await (0,o.v$)("/api/user/booking/checkout/combined",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:parseInt(e),cardNumber:a,expiryDate:i})}),r=await t.json();if(!t.ok)throw 440===t.status&&f.push("/ui/error/session-expired"),Error(r.error);console.log("Checkout Page: API response data:",r),g(r.message),m(r.invoice),localStorage.clear()}catch(e){u(e.message||"Checkout error")}finally{p(!1)}};return b?(0,a.jsx)("div",{className:"flex justify-center items-center h-64 ".concat("dark"===y?"text-white":"text-gray-800"),children:(0,a.jsx)("div",{className:"text-lg font-medium animate-pulse",children:"Loading..."})}):d?(0,a.jsx)("div",{className:"flex justify-center items-center h-64 ".concat("dark"===y?"text-white":"text-gray-800"),children:(0,a.jsxs)("div",{className:"px-6 py-4 rounded-md shadow-md bg-white",children:[(0,a.jsx)("p",{className:"font-semibold text-red-500",children:"Error:"}),(0,a.jsx)("p",{className:"text-red-500",children:d}),(0,a.jsx)("button",{onClick:()=>f.back(),className:"hover:underline cursor-pointer mt-2 text-red-500",children:"Go Back"})]})}):(0,a.jsxs)("div",{className:"max-w-lg mx-auto p-5 ".concat("dark"===y?"text-white":"text-gray-800"),children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Checkout"}),(0,a.jsxs)("p",{className:"mb-4",children:[(0,a.jsx)("strong",{children:"Booking ID:"})," ",e||"Not found"]}),h?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-green-500 mb-4",children:h}),x&&(0,a.jsx)("button",{onClick:()=>{if(!x)return;let e=atob(x),t=Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);let r=new Blob([new Uint8Array(t)],{type:"application/pdf"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download="itinerary.pdf",n.click(),URL.revokeObjectURL(a)},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors mb-2",children:"Download Itinerary PDF"}),(0,a.jsx)("button",{onClick:()=>f.push("/ui/dashboard/bookings"),className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"View Bookings"})]}):(0,a.jsxs)("form",{onSubmit:k,className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:["Credit Card Number:",(0,a.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value),placeholder:"16-digit card number",required:!0,className:"p-2 rounded-md border ".concat("dark"===y?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:["Expiry Date (MM/YY):",(0,a.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"MM/YY",required:!0,className:"p-2 rounded-md border ".concat("dark"===y?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800")})]}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Processing...":"Pay and Confirm Booking"})]})]})}function c(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(i,{})})}},9292:(e,t,r)=>{"use strict";r.d(t,{v$:()=>n}),r(8801),r(9980);var a=r(9509);async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch(e,{...t,credentials:"include"});if(401===r.status||403===r.status){if(!await s())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});r=await fetch(e,{...t,credentials:"include"})}return r}a.env.ACCESS_SECRET,a.env.REFRESH_SECRET,a.env.ACCESS_TOKEN_EXPIRY,a.env.REFRESH_TOKEN_EXPIRY,parseInt(a.env.SALT_ROUNDS,10);async function s(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,8441,1684,7358],()=>t(3856)),_N_E=e.O()}]);