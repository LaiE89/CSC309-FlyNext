(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8399],{5144:(e,t,a)=>{Promise.resolve().then(a.bind(a,9348))},5550:(e,t,a)=>{"use strict";a.d(t,{D:()=>l,N:()=>n});var r=a(5155),s=a(2115);let i=(0,s.createContext)();function n(e){let{children:t}=e,[a,n]=(0,s.useState)("dark"),[l,c]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{c(!0)},[]),l)?(0,r.jsx)(i.Provider,{value:{theme:a,toggleTheme:()=>{n("dark"===a?"light":"dark")}},children:t}):null}function l(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6960:(e,t,a)=>{"use strict";a.d(t,{J:()=>l,v:()=>n});var r=a(5155),s=a(2115);let i=(0,s.createContext)();function n(e){let{children:t}=e,[a,n]=(0,s.useState)(null),[l,c]=(0,s.useState)("VISITOR"),[o,d]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async function(){try{let e=await fetch("/api/user/profile",{method:"GET",credentials:"include"});if(!e.ok){n(null),c("VISITOR");return}let t=await e.json();n(t),c(t.role||"VISITOR")}catch(e){n(null),c("VISITOR")}})()},[]),(0,r.jsx)(i.Provider,{value:{user:a,userRole:l,setUser:n,setUserRole:c,refreshBadge:()=>{d(!1),setTimeout(()=>{d(!0)},100)}},children:t})}function l(){return(0,s.useContext)(i)}},9292:(e,t,a)=>{"use strict";a.d(t,{v$:()=>s}),a(8801),a(9980);var r=a(9509);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await fetch(e,{...t,credentials:"include"});if(401===a.status||403===a.status){if(!await i())return new Response(JSON.stringify({message:"Session expired"}),{status:440,headers:{"Content-Type":"application/json"}});a=await fetch(e,{...t,credentials:"include"})}return a}r.env.ACCESS_SECRET,r.env.REFRESH_SECRET,r.env.ACCESS_TOKEN_EXPIRY,r.env.REFRESH_TOKEN_EXPIRY,parseInt(r.env.SALT_ROUNDS,10);async function i(){try{if(!(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok)return!1;return!0}catch(e){return!1}}},9348:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(5155),s=a(2115),i=a(5695),n=a(6960),l=a(5550),c=a(6766),o=a(9292);function d(){var e;let{id:t,roomId:a}=(0,i.useParams)(),{theme:d}=(0,l.D)(),{userRole:h}=(0,n.J)(),u=(0,i.useRouter)(),[x,m]=(0,s.useState)(null),[g,f]=(0,s.useState)(!0),[b,p]=(0,s.useState)(""),[v,k]=(0,s.useState)(""),[y,w]=(0,s.useState)(""),j=localStorage.getItem("currentBookingId"),N=j?parseInt(j,10):null;(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/visitor/hotels/".concat(t,"/").concat(a),{method:"GET",credentials:"include"}),r=await e.json();if(!e.ok)throw Error(r.error||"Failed to fetch room details.");m(r.room)}catch(e){p(e instanceof Error?e.message:"An error occurred.")}finally{f(!1)}})()},[t,a]),(0,s.useEffect)(()=>{b&&window.scrollTo(0,0)},[b]);let S=async()=>{if(!v||!y){p("Please select both check-in and check-out dates.");return}f(!0);try{let e,t;let a={roomBookingInfo:JSON.stringify({roomId:x.id,type:x.type,pricePerNight:x.pricePerNight,amenities:x.amenities,checkIn:v,checkOut:y,hotelId:x.hotelId})};if(N?(e=await (0,o.v$)("/api/user/booking/edit",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bookingId:parseInt(N),...a,checkIn:v,checkOut:y,hotelId:x.hotelId,roomId:x.id})}),t=await e.json()):(e=await (0,o.v$)("/api/user/booking/create/combined",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json(),localStorage.setItem("currentBookingId",t.id)),!e.ok)throw 440===e.status&&u.push("/ui/error/session-expired"),Error(t.error||"Failed to book room.");u.push("/ui/dashboard/booking")}catch(e){p(e.message||"Failed to create booking. Please try again.")}finally{f(!1)}};return g?(0,r.jsx)("div",{className:"flex justify-center items-center h-64 ".concat("dark"===d?"text-white":"text-gray-800"),children:(0,r.jsx)("div",{className:"text-lg font-medium animate-pulse",children:"Loading..."})}):b?(0,r.jsx)("div",{className:"flex justify-center items-center h-64 ".concat("dark"===d?"text-white":"text-gray-800"),children:(0,r.jsxs)("div",{className:"px-6 py-4 rounded-md shadow-md bg-white",children:[(0,r.jsx)("p",{className:"font-semibold text-red-500",children:"Error:"}),(0,r.jsx)("p",{className:"text-red-500",children:b}),(0,r.jsx)("button",{onClick:()=>u.back(),className:"hover:underline cursor-pointer mt-2 text-red-500",children:"Go Back"})]})}):x?(0,r.jsxs)("div",{className:"max-w-5xl mx-auto p-6 rounded-2xl shadow-lg space-y-6 ".concat("dark"===d?"bg-gray-800 text-white":"bg-white text-gray-800"),children:[b&&(0,r.jsx)("div",{className:"text-red-500",children:b}),(0,r.jsx)("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold ".concat("dark"===d?"text-white":"text-black"),children:x.type}),(0,r.jsx)("p",{className:"text-lg font-medium ".concat(x.available?"text-green-500":"text-red-500"),children:x.available?"Available":"Not Available"}),(0,r.jsxs)("p",{className:"text-lg mt-1 ".concat("dark"===d?"text-gray-300":"text-gray-800"),children:[(0,r.jsxs)("span",{className:"font-semibold",children:["$",x.pricePerNight]})," / night"]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-semibold mb-2 ".concat("dark"===d?"text-white":"text-black"),children:"Amenities"}),(0,r.jsx)("ul",{className:"grid grid-cols-1 gap-2 text-sm ".concat("dark"===d?"text-gray-300":"text-gray-800"),children:x.amenities.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"â€¢"})," ",e]},t))})]}),(null===(e=x.images)||void 0===e?void 0:e.length)>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-semibold mb-2 ".concat("dark"===d?"text-white":"text-gray-800"),children:"Photos"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.images.map((e,t)=>(0,r.jsx)(c.default,{src:e,alt:"Room Image ".concat(t+1),width:2880,height:1624,className:"w-full h-full object-cover rounded-lg shadow-sm"},t))})]}),("USER"===h||"HOTEL_OWNER"===h)&&x.available&&(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"checkIn",className:"block font-semibold mb-1 ".concat("dark"===d?"text-white":"text-gray-800"),children:"Check-In Date"}),(0,r.jsx)("input",{type:"date",id:"checkIn",value:v,onChange:e=>k(e.target.value),className:"w-full border rounded-lg p-2 ".concat("dark"===d?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"checkOut",className:"block font-semibold mb-1 ".concat("dark"===d?"text-white":"text-gray-800"),children:"Check-Out Date"}),(0,r.jsx)("input",{type:"date",id:"checkOut",value:y,onChange:e=>w(e.target.value),className:"w-full border rounded-lg p-2 ".concat("dark"===d?"bg-gray-700 text-white border-gray-600":"bg-white text-black border-gray-300")})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 mt-4",children:[("USER"===h||"HOTEL_OWNER"===h)&&x.available&&(0,r.jsx)("button",{onClick:S,className:"py-2 px-5 rounded-lg transition ".concat("dark"===d?"bg-green-600 hover:bg-green-700 text-white":"bg-green-500 hover:bg-green-600 text-white"),children:"Book Room"}),(0,r.jsx)("button",{onClick:()=>u.back(),className:"py-2 px-5 rounded-lg transition ".concat("dark"===d?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:"Go Back"})]})]}):(0,r.jsx)("div",{className:"flex justify-center items-center h-64 ".concat("dark"===d?"text-white":"text-gray-800"),children:(0,r.jsx)("div",{className:"text-lg font-medium",children:"Room not found"})})}},9825:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[9268,3877,6766,8441,1684,7358],()=>t(5144)),_N_E=e.O()}]);